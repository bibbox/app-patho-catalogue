!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[8,41],{JKx6:function(t,r,a){"use strict";a.d(r,"a",(function(){return S}));var i=a("8Y7J"),s=a("QOHy"),o=a("J3qs"),l=a("Kj3r"),u=a("lJxs"),c=a("TSSN"),d=a("wLgS"),p=a("lI3o"),f=a("SVse"),m=a("hqmO"),v=a("s7LF");function h(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"ds-form",5),i["\u0275\u0275text"](1,"\n"),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",n.FORM_PREFIX)("formModel",n.formModel)("formGroup",n.formGroup)("displaySubmit",!1)("displayCancel",!1)}}function I(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",6),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,n.FORM_PREFIX+"error.password-length"))}}function g(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",7),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,n.FORM_PREFIX+"error.matching-passwords"))}}function y(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",8),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,n.FORM_PREFIX+"error.empty-password"))}}var S=function(){var t=function(){function t(n,r,a,o){e(this,t),this.formService=n,this.translate=r,this.epersonService=a,this.notificationsService=o,this.isInvalid=new i.EventEmitter,this.passwordValue=new i.EventEmitter,this.formModel=[new s.I({id:"password",name:"password",inputType:"password"}),new s.I({id:"passwordrepeat",name:"passwordrepeat",inputType:"password"})],this.passwordCanBeEmpty=!0,this.subs=[]}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.formGroup=this.formService.createFormGroup(this.formModel,this.passwordCanBeEmpty?{validators:[this.checkPasswordsEqual,this.checkPasswordLength]}:{validators:[this.checkPasswordsEqual,this.checkPasswordLength,this.checkPasswordEmpty]}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe((function(){e.updateFieldTranslations()})),this.subs.push(this.formGroup.statusChanges.pipe(Object(l.a)(300),Object(u.a)((function(e){return"VALID"!==e}))).subscribe((function(t){return e.isInvalid.emit(t)}))),this.subs.push(this.formGroup.valueChanges.pipe(Object(l.a)(300)).subscribe((function(t){e.passwordValue.emit(t.password)})))}},{key:"updateFieldTranslations",value:function(){var e=this;this.formModel.forEach((function(t){t.label=e.translate.instant(e.FORM_PREFIX+"label."+t.id)}))}},{key:"checkPasswordsEqual",value:function(e){return e.get("password").value===e.get("passwordrepeat").value?null:{notSame:!0}}},{key:"checkPasswordLength",value:function(e){var t=e.get("password").value;return Object(o.d)(t)||t.length>=6?null:{notLongEnough:!0}}},{key:"checkPasswordEmpty",value:function(e){var t=e.get("password").value;return Object(o.d)(t)?{emptyPassword:!0}:null}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(o.b)(e)})).forEach((function(e){return e.unsubscribe()}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(i["\u0275\u0275directiveInject"](s.F),i["\u0275\u0275directiveInject"](c.f),i["\u0275\u0275directiveInject"](d.a),i["\u0275\u0275directiveInject"](p.a))},t.\u0275cmp=i["\u0275\u0275defineComponent"]({type:t,selectors:[["ds-profile-page-security-form"]],inputs:{passwordCanBeEmpty:"passwordCanBeEmpty",FORM_PREFIX:"FORM_PREFIX"},outputs:{isInvalid:"isInvalid",passwordValue:"passwordValue"},decls:12,vars:7,consts:[[1,"container-fluid","mb-4"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],["id","notLongEnough","class","container-fluid text-danger",4,"ngIf"],["id","notSame","class","container-fluid text-danger",4,"ngIf"],["id","emptyPassword","class","container-fluid text-danger",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"],["id","notLongEnough",1,"container-fluid","text-danger"],["id","notSame",1,"container-fluid","text-danger"],["id","emptyPassword",1,"container-fluid","text-danger"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](3,"\n"),i["\u0275\u0275template"](4,h,2,5,"ds-form",1),i["\u0275\u0275text"](5,"\n"),i["\u0275\u0275template"](6,I,3,3,"div",2),i["\u0275\u0275text"](7,"\n"),i["\u0275\u0275template"](8,g,3,3,"div",3),i["\u0275\u0275text"](9,"\n"),i["\u0275\u0275template"](10,y,3,3,"div",4),i["\u0275\u0275text"](11,"\n")),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,5,t.FORM_PREFIX+"info")),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",t.formModel),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.formGroup.hasError("notLongEnough")),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.formGroup.hasError("notSame")),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",(t.formGroup.dirty||t.formGroup.touched)&&t.formGroup.hasError("emptyPassword")))},directives:[f.u,m.a,v.NgControlStatusGroup,v.FormGroupDirective],pipes:[c.e],encapsulation:2}),t}()},wStq:function(t,r,a){"use strict";a.r(r),a.d(r,"ProfilePageComponent",(function(){return _}));var i=a("QOHy"),s=a("J3qs"),o=a("LvDl"),l=a("1QIV"),u=a("AytR"),c=a("8Y7J"),d=a("Q5/L"),p=a("TSSN"),f=a("wLgS"),m=a("lI3o"),v=a("SVse"),h=a("hqmO"),I=a("s7LF");function g(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"ds-form",1),c["\u0275\u0275text"](1,"\n"),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275property"]("formId","profile-page-metadata-form-id")("formModel",n.formModel)("formGroup",n.formGroup)("displaySubmit",!1)("displayCancel",!1)}}var y,S=((y=function(){function t(n,r,a,s){e(this,t),this.formBuilderService=n,this.translate=r,this.epersonService=a,this.notificationsService=s,this.formModel=[new i.I({id:"email",name:"email",readOnly:!0}),new i.I({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new i.I({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new i.I({id:"phone",name:"eperson.phone"}),new i.M({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.activeLangs=u.a.languages.filter((function(e){return!0===e.active})),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe((function(){e.updateFieldTranslations()}))}},{key:"setFormValues",value:function(){var e=this;this.formModel.forEach((function(t){t.value="email"===t.name?e.user.email:e.user.firstMetadataValue(t.name),"language"===t.id&&(t.options=e.activeLangs.map((function(e){return Object.assign({value:e.code,label:e.label})})))})),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}},{key:"updateFieldTranslations",value:function(){var e=this;this.formModel.forEach((function(t){t.label=e.translate.instant(e.LABEL_PREFIX+t.id),Object(s.e)(t.validators)&&(t.errorMessages={},Object.keys(t.validators).forEach((function(n){t.errorMessages[n]=e.translate.instant(e.ERROR_PREFIX+t.id+"."+n)})))}))}},{key:"updateProfile",value:function(){var e=this;if(!this.formGroup.valid)return!1;var t=Object(o.cloneDeep)(this.user.metadata),n=!1;return this.formModel.filter((function(e){return"email"!==e.id})).forEach((function(e){t.hasOwnProperty(e.name)&&t[e.name].length>0?Object(s.b)(e.value)?t[e.name][0].value!==e.value&&(t[e.name][0].value=e.value,n=!0):(t[e.name]=[],n=!0):Object(s.b)(e.value)&&(t[e.name]=[{value:e.value,language:null}],n=!0)})),n&&this.epersonService.update(Object.assign(Object(o.cloneDeep)(this.user),{metadata:t})).pipe(Object(l.i)(),Object(l.o)()).subscribe((function(t){e.user=t,e.setFormValues(),e.notificationsService.success(e.translate.instant(e.NOTIFICATION_PREFIX+"success.title"),e.translate.instant(e.NOTIFICATION_PREFIX+"success.content"))})),n}}]),t}()).\u0275fac=function(e){return new(e||y)(c["\u0275\u0275directiveInject"](d.a),c["\u0275\u0275directiveInject"](p.f),c["\u0275\u0275directiveInject"](f.a),c["\u0275\u0275directiveInject"](m.a))},y.\u0275cmp=c["\u0275\u0275defineComponent"]({type:y,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},decls:2,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(e,t){1&e&&(c["\u0275\u0275template"](0,g,2,5,"ds-form",0),c["\u0275\u0275text"](1,"\n")),2&e&&c["\u0275\u0275property"]("ngIf",t.formModel)},directives:[v.u,h.a,I.NgControlStatusGroup,I.FormGroupDirective],encapsulation:2}),y),x=a("pLZG"),E=a("eIep"),O=a("vkgz"),b=a("84Zn"),w=a("Vurf"),F=a("O/5o"),P=a("JKx6");function R(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"li",16),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate"](n.name)}}function C(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"div"),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275elementStart"](2,"h3",13),c["\u0275\u0275text"](3),c["\u0275\u0275pipe"](4,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](5,"\n        "),c["\u0275\u0275elementStart"](6,"ul",14),c["\u0275\u0275text"](7,"\n          "),c["\u0275\u0275template"](8,R,2,1,"li",15),c["\u0275\u0275text"](9,"\n        "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](10,"\n      "),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().ngVar;c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](4,2,"profile.groups.head")),c["\u0275\u0275advance"](5),c["\u0275\u0275property"]("ngForOf",n)}}function j(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275template"](2,C,11,4,"div",12),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.ngVar;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",n)}}function M(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"div",2),c["\u0275\u0275text"](1,"\n    "),c["\u0275\u0275elementStart"](2,"h3",3),c["\u0275\u0275text"](3),c["\u0275\u0275pipe"](4,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](5,"\n    "),c["\u0275\u0275elementStart"](6,"div",4),c["\u0275\u0275text"](7,"\n      "),c["\u0275\u0275elementStart"](8,"div",5),c["\u0275\u0275text"](9),c["\u0275\u0275pipe"](10,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](11,"\n      "),c["\u0275\u0275elementStart"](12,"div",6),c["\u0275\u0275text"](13,"\n        "),c["\u0275\u0275element"](14,"ds-profile-page-metadata-form",7),c["\u0275\u0275text"](15,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](16,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](17,"\n    "),c["\u0275\u0275elementStart"](18,"div",4),c["\u0275\u0275text"](19,"\n      "),c["\u0275\u0275elementStart"](20,"div",5),c["\u0275\u0275text"](21),c["\u0275\u0275pipe"](22,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](23,"\n      "),c["\u0275\u0275elementStart"](24,"div",6),c["\u0275\u0275text"](25,"\n        "),c["\u0275\u0275elementStart"](26,"ds-profile-page-security-form",8),c["\u0275\u0275listener"]("isInvalid",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"](2).setInvalid(e)}))("passwordValue",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"](2).setPasswordValue(e)})),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](27,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](28,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](29,"\n    "),c["\u0275\u0275elementStart"](30,"div",9),c["\u0275\u0275text"](31,"\n      "),c["\u0275\u0275elementStart"](32,"button",10),c["\u0275\u0275listener"]("click",(function(){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"](2).updateProfile()})),c["\u0275\u0275element"](33,"i",11),c["\u0275\u0275text"](34),c["\u0275\u0275pipe"](35,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](36,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](37,"\n\n    "),c["\u0275\u0275template"](38,j,4,1,"ng-container",0),c["\u0275\u0275pipe"](39,"async"),c["\u0275\u0275text"](40,"\n  "),c["\u0275\u0275elementEnd"]()}if(2&e){var r,a=c["\u0275\u0275nextContext"]().ngVar,i=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](4,7,"profile.head")),c["\u0275\u0275advance"](6),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](10,9,"profile.card.identify")),c["\u0275\u0275advance"](5),c["\u0275\u0275property"]("user",a),c["\u0275\u0275advance"](7),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](22,11,"profile.card.security")),c["\u0275\u0275advance"](5),c["\u0275\u0275property"]("FORM_PREFIX","profile.security.form."),c["\u0275\u0275advance"](8),c["\u0275\u0275textInterpolate1"](" ",c["\u0275\u0275pipeBind1"](35,13,"profile.form.submit"),""),c["\u0275\u0275advance"](4),c["\u0275\u0275property"]("ngVar",null==(r=c["\u0275\u0275pipeBind1"](39,15,i.groupsRD$))||null==r.payload?null:r.payload.page)}}function T(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275template"](2,M,41,17,"div",1),c["\u0275\u0275text"](3,"\n"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.ngVar;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",n)}}var k,_=((k=function(){function t(n,r,a,i){e(this,t),this.authService=n,this.notificationsService=r,this.translate=a,this.epersonService=i,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications."}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.user$=this.authService.getAuthenticatedUserFromStore().pipe(Object(x.a)((function(e){return Object(s.b)(e.id)})),Object(E.a)((function(t){return e.epersonService.findById(t.id,!0,!0,Object(b.a)("groups"))})),Object(l.c)(),Object(l.o)(),Object(O.a)((function(t){return e.currentUser=t}))),this.groupsRD$=this.user$.pipe(Object(E.a)((function(e){return e.groups})))}},{key:"updateProfile",value:function(){var e=this.metadataForm.updateProfile(),t=this.updateSecurity();e||t||this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}},{key:"setInvalid",value:function(e){this.invalidSecurity=e}},{key:"updateSecurity",value:function(){var e=this,t=Object(s.e)(this.password);return this.invalidSecurity&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&t&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:this.password}]).pipe(Object(l.g)()).subscribe((function(t){t.hasSucceeded?e.notificationsService.success(e.translate.instant(e.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),e.translate.instant(e.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):e.notificationsService.error(e.translate.instant(e.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),t.errorMessage)})),t}},{key:"setPasswordValue",value:function(e){this.password=e}},{key:"submit",value:function(){this.updateProfile()}}]),t}()).\u0275fac=function(e){return new(e||k)(c["\u0275\u0275directiveInject"](w.a),c["\u0275\u0275directiveInject"](m.a),c["\u0275\u0275directiveInject"](p.f),c["\u0275\u0275directiveInject"](f.a))},k.\u0275cmp=c["\u0275\u0275defineComponent"]({type:k,selectors:[["ds-profile-page"]],viewQuery:function(e,t){var n;1&e&&c["\u0275\u0275viewQuery"](S,!0),2&e&&c["\u0275\u0275queryRefresh"](n=c["\u0275\u0275loadQuery"]())&&(t.metadataForm=n.first)},decls:3,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[1,"mb-4"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],[3,"FORM_PREFIX","isInvalid","passwordValue"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[4,"ngIf"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"]],template:function(e,t){1&e&&(c["\u0275\u0275template"](0,T,4,1,"ng-container",0),c["\u0275\u0275pipe"](1,"async"),c["\u0275\u0275text"](2,"\n")),2&e&&c["\u0275\u0275property"]("ngVar",c["\u0275\u0275pipeBind1"](1,1,t.user$))},directives:[F.a,v.u,S,P.a,v.t],pipes:[v.b,p.e],styles:[""]}),k)}}])}();
//# sourceMappingURL=8-es5.a3fa6a55860eaeae82a0.js.map