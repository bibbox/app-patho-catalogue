(window.webpackJsonp=window.webpackJsonp||[]).push([[8,40],{JKx6:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n("8Y7J"),a=n("QOHy"),i=n("J3qs"),s=n("Kj3r"),o=n("lJxs"),l=n("TSSN"),d=n("wLgS"),p=n("lI3o"),c=n("SVse"),u=n("hqmO"),m=n("s7LF");function f(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"ds-form",5),r["\u0275\u0275text"](1,"\n"),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275property"]("formId",e.FORM_PREFIX)("formModel",e.formModel)("formGroup",e.formGroup)("displaySubmit",!1)("displayCancel",!1)}}function h(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",6),r["\u0275\u0275text"](1),r["\u0275\u0275pipe"](2,"translate"),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate"](r["\u0275\u0275pipeBind1"](2,1,e.FORM_PREFIX+"error.password-length"))}}function v(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",7),r["\u0275\u0275text"](1),r["\u0275\u0275pipe"](2,"translate"),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate"](r["\u0275\u0275pipeBind1"](2,1,e.FORM_PREFIX+"error.matching-passwords"))}}function I(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",8),r["\u0275\u0275text"](1),r["\u0275\u0275pipe"](2,"translate"),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate"](r["\u0275\u0275pipeBind1"](2,1,e.FORM_PREFIX+"error.empty-password"))}}let g=(()=>{class e{constructor(e,t,n,i){this.formService=e,this.translate=t,this.epersonService=n,this.notificationsService=i,this.isInvalid=new r.EventEmitter,this.passwordValue=new r.EventEmitter,this.formModel=[new a.I({id:"password",name:"password",inputType:"password"}),new a.I({id:"passwordrepeat",name:"passwordrepeat",inputType:"password"})],this.passwordCanBeEmpty=!0,this.subs=[]}ngOnInit(){this.formGroup=this.formService.createFormGroup(this.formModel,this.passwordCanBeEmpty?{validators:[this.checkPasswordsEqual,this.checkPasswordLength]}:{validators:[this.checkPasswordsEqual,this.checkPasswordLength,this.checkPasswordEmpty]}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}),this.subs.push(this.formGroup.statusChanges.pipe(Object(s.a)(300),Object(o.a)(e=>"VALID"!==e)).subscribe(e=>this.isInvalid.emit(e))),this.subs.push(this.formGroup.valueChanges.pipe(Object(s.a)(300)).subscribe(e=>{this.passwordValue.emit(e.password)}))}updateFieldTranslations(){this.formModel.forEach(e=>{e.label=this.translate.instant(this.FORM_PREFIX+"label."+e.id)})}checkPasswordsEqual(e){return e.get("password").value===e.get("passwordrepeat").value?null:{notSame:!0}}checkPasswordLength(e){const t=e.get("password").value;return Object(i.d)(t)||t.length>=6?null:{notLongEnough:!0}}checkPasswordEmpty(e){const t=e.get("password").value;return Object(i.d)(t)?{emptyPassword:!0}:null}ngOnDestroy(){this.subs.filter(e=>Object(i.b)(e)).forEach(e=>e.unsubscribe())}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](a.F),r["\u0275\u0275directiveInject"](l.f),r["\u0275\u0275directiveInject"](d.a),r["\u0275\u0275directiveInject"](p.a))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-profile-page-security-form"]],inputs:{passwordCanBeEmpty:"passwordCanBeEmpty",FORM_PREFIX:"FORM_PREFIX"},outputs:{isInvalid:"isInvalid",passwordValue:"passwordValue"},decls:12,vars:7,consts:[[1,"container-fluid","mb-4"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],["id","notLongEnough","class","container-fluid text-danger",4,"ngIf"],["id","notSame","class","container-fluid text-danger",4,"ngIf"],["id","emptyPassword","class","container-fluid text-danger",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"],["id","notLongEnough",1,"container-fluid","text-danger"],["id","notSame",1,"container-fluid","text-danger"],["id","emptyPassword",1,"container-fluid","text-danger"]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"div",0),r["\u0275\u0275text"](1),r["\u0275\u0275pipe"](2,"translate"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275text"](3,"\n"),r["\u0275\u0275template"](4,f,2,5,"ds-form",1),r["\u0275\u0275text"](5,"\n"),r["\u0275\u0275template"](6,h,3,3,"div",2),r["\u0275\u0275text"](7,"\n"),r["\u0275\u0275template"](8,v,3,3,"div",3),r["\u0275\u0275text"](9,"\n"),r["\u0275\u0275template"](10,I,3,3,"div",4),r["\u0275\u0275text"](11,"\n")),2&e&&(r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate"](r["\u0275\u0275pipeBind1"](2,5,t.FORM_PREFIX+"info")),r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("ngIf",t.formModel),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",t.formGroup.hasError("notLongEnough")),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",t.formGroup.hasError("notSame")),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",(t.formGroup.dirty||t.formGroup.touched)&&t.formGroup.hasError("emptyPassword")))},directives:[c.u,u.a,m.NgControlStatusGroup,m.FormGroupDirective],pipes:[l.e],encapsulation:2}),e})()},wStq:function(e,t,n){"use strict";n.r(t),n.d(t,"ProfilePageComponent",(function(){return j}));var r=n("QOHy"),a=n("J3qs"),i=n("LvDl"),s=n("1QIV"),o=n("AytR"),l=n("8Y7J"),d=n("Q5/L"),p=n("TSSN"),c=n("wLgS"),u=n("lI3o"),m=n("SVse"),f=n("hqmO"),h=n("s7LF");function v(e,t){if(1&e&&(l["\u0275\u0275elementStart"](0,"ds-form",1),l["\u0275\u0275text"](1,"\n"),l["\u0275\u0275elementEnd"]()),2&e){const e=l["\u0275\u0275nextContext"]();l["\u0275\u0275property"]("formId","profile-page-metadata-form-id")("formModel",e.formModel)("formGroup",e.formGroup)("displaySubmit",!1)("displayCancel",!1)}}let I=(()=>{class e{constructor(e,t,n,a){this.formBuilderService=e,this.translate=t,this.epersonService=n,this.notificationsService=a,this.formModel=[new r.I({id:"email",name:"email",readOnly:!0}),new r.I({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new r.I({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new r.I({id:"phone",name:"eperson.phone"}),new r.M({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=o.a.languages.filter(e=>!0===e.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(e=>{e.value="email"===e.name?this.user.email:this.user.firstMetadataValue(e.name),"language"===e.id&&(e.options=this.activeLangs.map(e=>Object.assign({value:e.code,label:e.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(e=>{e.label=this.translate.instant(this.LABEL_PREFIX+e.id),Object(a.e)(e.validators)&&(e.errorMessages={},Object.keys(e.validators).forEach(t=>{e.errorMessages[t]=this.translate.instant(this.ERROR_PREFIX+e.id+"."+t)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const e=Object(i.cloneDeep)(this.user.metadata);let t=!1;return this.formModel.filter(e=>"email"!==e.id).forEach(n=>{e.hasOwnProperty(n.name)&&e[n.name].length>0?Object(a.b)(n.value)?e[n.name][0].value!==n.value&&(e[n.name][0].value=n.value,t=!0):(e[n.name]=[],t=!0):Object(a.b)(n.value)&&(e[n.name]=[{value:n.value,language:null}],t=!0)}),t&&this.epersonService.update(Object.assign(Object(i.cloneDeep)(this.user),{metadata:e})).pipe(Object(s.i)(),Object(s.o)()).subscribe(e=>{this.user=e,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),t}}return e.\u0275fac=function(t){return new(t||e)(l["\u0275\u0275directiveInject"](d.a),l["\u0275\u0275directiveInject"](p.f),l["\u0275\u0275directiveInject"](c.a),l["\u0275\u0275directiveInject"](u.a))},e.\u0275cmp=l["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},decls:2,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(e,t){1&e&&(l["\u0275\u0275template"](0,v,2,5,"ds-form",0),l["\u0275\u0275text"](1,"\n")),2&e&&l["\u0275\u0275property"]("ngIf",t.formModel)},directives:[m.u,f.a,h.NgControlStatusGroup,h.FormGroupDirective],encapsulation:2}),e})();var g=n("pLZG"),S=n("eIep"),x=n("vkgz"),E=n("84Zn"),O=n("Vurf"),w=n("O/5o"),y=n("JKx6");function b(e,t){if(1&e&&(l["\u0275\u0275elementStart"](0,"li",16),l["\u0275\u0275text"](1),l["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate"](e.name)}}function F(e,t){if(1&e&&(l["\u0275\u0275elementStart"](0,"div"),l["\u0275\u0275text"](1,"\n        "),l["\u0275\u0275elementStart"](2,"h3",13),l["\u0275\u0275text"](3),l["\u0275\u0275pipe"](4,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](5,"\n        "),l["\u0275\u0275elementStart"](6,"ul",14),l["\u0275\u0275text"](7,"\n          "),l["\u0275\u0275template"](8,b,2,1,"li",15),l["\u0275\u0275text"](9,"\n        "),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](10,"\n      "),l["\u0275\u0275elementEnd"]()),2&e){const e=l["\u0275\u0275nextContext"]().ngVar;l["\u0275\u0275advance"](3),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](4,2,"profile.groups.head")),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("ngForOf",e)}}function P(e,t){if(1&e&&(l["\u0275\u0275elementContainerStart"](0),l["\u0275\u0275text"](1,"\n      "),l["\u0275\u0275template"](2,F,11,4,"div",12),l["\u0275\u0275text"](3,"\n    "),l["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.ngVar;l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngIf",e)}}function R(e,t){if(1&e){const e=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"div",2),l["\u0275\u0275text"](1,"\n    "),l["\u0275\u0275elementStart"](2,"h3",3),l["\u0275\u0275text"](3),l["\u0275\u0275pipe"](4,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](5,"\n    "),l["\u0275\u0275elementStart"](6,"div",4),l["\u0275\u0275text"](7,"\n      "),l["\u0275\u0275elementStart"](8,"div",5),l["\u0275\u0275text"](9),l["\u0275\u0275pipe"](10,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](11,"\n      "),l["\u0275\u0275elementStart"](12,"div",6),l["\u0275\u0275text"](13,"\n        "),l["\u0275\u0275element"](14,"ds-profile-page-metadata-form",7),l["\u0275\u0275text"](15,"\n      "),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](16,"\n    "),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](17,"\n    "),l["\u0275\u0275elementStart"](18,"div",4),l["\u0275\u0275text"](19,"\n      "),l["\u0275\u0275elementStart"](20,"div",5),l["\u0275\u0275text"](21),l["\u0275\u0275pipe"](22,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](23,"\n      "),l["\u0275\u0275elementStart"](24,"div",6),l["\u0275\u0275text"](25,"\n        "),l["\u0275\u0275elementStart"](26,"ds-profile-page-security-form",8),l["\u0275\u0275listener"]("isInvalid",(function(t){return l["\u0275\u0275restoreView"](e),l["\u0275\u0275nextContext"](2).setInvalid(t)}))("passwordValue",(function(t){return l["\u0275\u0275restoreView"](e),l["\u0275\u0275nextContext"](2).setPasswordValue(t)})),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](27,"\n      "),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](28,"\n    "),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](29,"\n    "),l["\u0275\u0275elementStart"](30,"div",9),l["\u0275\u0275text"](31,"\n      "),l["\u0275\u0275elementStart"](32,"button",10),l["\u0275\u0275listener"]("click",(function(){return l["\u0275\u0275restoreView"](e),l["\u0275\u0275nextContext"](2).updateProfile()})),l["\u0275\u0275element"](33,"i",11),l["\u0275\u0275text"](34),l["\u0275\u0275pipe"](35,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](36,"\n    "),l["\u0275\u0275elementEnd"](),l["\u0275\u0275text"](37,"\n\n    "),l["\u0275\u0275template"](38,P,4,1,"ng-container",0),l["\u0275\u0275pipe"](39,"async"),l["\u0275\u0275text"](40,"\n  "),l["\u0275\u0275elementEnd"]()}if(2&e){const e=l["\u0275\u0275nextContext"]().ngVar,t=l["\u0275\u0275nextContext"]();var n;l["\u0275\u0275advance"](3),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](4,7,"profile.head")),l["\u0275\u0275advance"](6),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](10,9,"profile.card.identify")),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("user",e),l["\u0275\u0275advance"](7),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](22,11,"profile.card.security")),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("FORM_PREFIX","profile.security.form."),l["\u0275\u0275advance"](8),l["\u0275\u0275textInterpolate1"](" ",l["\u0275\u0275pipeBind1"](35,13,"profile.form.submit"),""),l["\u0275\u0275advance"](4),l["\u0275\u0275property"]("ngVar",null==(n=l["\u0275\u0275pipeBind1"](39,15,t.groupsRD$))||null==n.payload?null:n.payload.page)}}function C(e,t){if(1&e&&(l["\u0275\u0275elementContainerStart"](0),l["\u0275\u0275text"](1,"\n  "),l["\u0275\u0275template"](2,R,41,17,"div",1),l["\u0275\u0275text"](3,"\n"),l["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.ngVar;l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngIf",e)}}let j=(()=>{class e{constructor(e,t,n,r){this.authService=e,this.notificationsService=t,this.translate=n,this.epersonService=r,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications."}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe(Object(g.a)(e=>Object(a.b)(e.id)),Object(S.a)(e=>this.epersonService.findById(e.id,!0,!0,Object(E.a)("groups"))),Object(s.c)(),Object(s.o)(),Object(x.a)(e=>this.currentUser=e)),this.groupsRD$=this.user$.pipe(Object(S.a)(e=>e.groups))}updateProfile(){const e=this.metadataForm.updateProfile(),t=this.updateSecurity();e||t||this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid(e){this.invalidSecurity=e}updateSecurity(){const e=Object(a.e)(this.password);return this.invalidSecurity&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&e&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:this.password}]).pipe(Object(s.g)()).subscribe(e=>{e.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),e.errorMessage)}),e}setPasswordValue(e){this.password=e}submit(){this.updateProfile()}}return e.\u0275fac=function(t){return new(t||e)(l["\u0275\u0275directiveInject"](O.a),l["\u0275\u0275directiveInject"](u.a),l["\u0275\u0275directiveInject"](p.f),l["\u0275\u0275directiveInject"](c.a))},e.\u0275cmp=l["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-profile-page"]],viewQuery:function(e,t){var n;1&e&&l["\u0275\u0275viewQuery"](I,!0),2&e&&l["\u0275\u0275queryRefresh"](n=l["\u0275\u0275loadQuery"]())&&(t.metadataForm=n.first)},decls:3,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[1,"mb-4"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],[3,"FORM_PREFIX","isInvalid","passwordValue"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[4,"ngIf"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"]],template:function(e,t){1&e&&(l["\u0275\u0275template"](0,C,4,1,"ng-container",0),l["\u0275\u0275pipe"](1,"async"),l["\u0275\u0275text"](2,"\n")),2&e&&l["\u0275\u0275property"]("ngVar",l["\u0275\u0275pipeBind1"](1,1,t.user$))},directives:[w.a,m.u,I,y.a,m.t],pipes:[m.b,p.e],styles:[""]}),e})()}}]);
//# sourceMappingURL=8-es2015.9428616fd99b637c0959.js.map