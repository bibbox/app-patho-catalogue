!function(){function t(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"SyZ+":function(n,i,a){"use strict";a.r(i),a.d(i,"BitstreamPageModule",(function(){return H}));var s=a("SVse"),l=a("PCNd"),d=a("iInd"),m=a("lJxs"),c=a("eIep"),u=a("5+tZ"),p=a("itXk"),f=a("LRne"),h=a("QOHy"),b=a("JN36"),v=a("LvDl"),y=a("1QIV"),g=a("87+M"),F=a("J3qs"),w=a("/eM4"),I=a("MEmd"),j=a("8Y7J"),O=a("TSSN"),S=a("PCBh"),C=a("lI3o"),M=a("B7d6"),x=a("O/5o"),E=a("/lGE"),k=a("hqmO"),N=a("s7LF"),B=a("HZwm"),L=a("Frqi"),T=a("t8/W");function P(t,e){if(1&t){var n=j["\u0275\u0275getCurrentView"]();j["\u0275\u0275elementStart"](0,"div",5),j["\u0275\u0275text"](1,"\n      "),j["\u0275\u0275elementStart"](2,"div",6),j["\u0275\u0275text"](3,"\n        "),j["\u0275\u0275element"](4,"ds-thumbnail",7),j["\u0275\u0275text"](5,"\n      "),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](6,"\n      "),j["\u0275\u0275elementStart"](7,"div",8),j["\u0275\u0275text"](8,"\n        "),j["\u0275\u0275elementStart"](9,"div",2),j["\u0275\u0275text"](10,"\n          "),j["\u0275\u0275elementStart"](11,"div",5),j["\u0275\u0275text"](12,"\n            "),j["\u0275\u0275elementStart"](13,"div",9),j["\u0275\u0275text"](14,"\n              "),j["\u0275\u0275elementStart"](15,"h3"),j["\u0275\u0275text"](16),j["\u0275\u0275elementStart"](17,"span",10),j["\u0275\u0275text"](18),j["\u0275\u0275pipe"](19,"dsFileSize"),j["\u0275\u0275elementEnd"](),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](20,"\n            "),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](21,"\n          "),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](22,"\n        "),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](23,"\n        "),j["\u0275\u0275elementStart"](24,"ds-form",11),j["\u0275\u0275listener"]("submitForm",(function(){return j["\u0275\u0275restoreView"](n),j["\u0275\u0275nextContext"](3).onSubmit()}))("cancel",(function(){return j["\u0275\u0275restoreView"](n),j["\u0275\u0275nextContext"](3).onCancel()}))("dfChange",(function(t){return j["\u0275\u0275restoreView"](n),j["\u0275\u0275nextContext"](3).onChange(t)})),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](25,"\n      "),j["\u0275\u0275elementEnd"](),j["\u0275\u0275text"](26,"\n    "),j["\u0275\u0275elementEnd"]()}if(2&t){var i=j["\u0275\u0275nextContext"](2).ngVar,r=j["\u0275\u0275nextContext"]();j["\u0275\u0275advance"](4),j["\u0275\u0275property"]("thumbnail",null==i?null:i.payload),j["\u0275\u0275advance"](12),j["\u0275\u0275textInterpolate1"]("",null==i||null==i.payload?null:i.payload.name," "),j["\u0275\u0275advance"](2),j["\u0275\u0275textInterpolate1"]("(",j["\u0275\u0275pipeBind1"](19,8,null==i||null==i.payload?null:i.payload.sizeBytes),")"),j["\u0275\u0275advance"](6),j["\u0275\u0275property"]("formId","edit-bitstream-form-id")("formGroup",r.formGroup)("formModel",r.formModel)("formLayout",r.formLayout)("submitLabel","form.save")}}function A(t,e){1&t&&(j["\u0275\u0275element"](0,"ds-error",12),j["\u0275\u0275pipe"](1,"translate")),2&t&&j["\u0275\u0275propertyInterpolate"]("message",j["\u0275\u0275pipeBind1"](1,1,"error.bitstream"))}function V(t,e){1&t&&(j["\u0275\u0275element"](0,"ds-loading",12),j["\u0275\u0275pipe"](1,"translate")),2&t&&j["\u0275\u0275propertyInterpolate"]("message",j["\u0275\u0275pipeBind1"](1,1,"loading.bitstream"))}function _(t,e){if(1&t&&(j["\u0275\u0275elementStart"](0,"div",2),j["\u0275\u0275text"](1,"\n    "),j["\u0275\u0275template"](2,P,27,10,"div",3),j["\u0275\u0275text"](3,"\n    "),j["\u0275\u0275template"](4,A,2,3,"ds-error",4),j["\u0275\u0275text"](5,"\n    "),j["\u0275\u0275template"](6,V,2,3,"ds-loading",4),j["\u0275\u0275text"](7,"\n  "),j["\u0275\u0275elementEnd"]()),2&t){var n=e.ngVar,i=j["\u0275\u0275nextContext"]().ngVar;j["\u0275\u0275advance"](2),j["\u0275\u0275property"]("ngIf",(null==i?null:i.hasSucceeded)&&(null==n?null:n.hasSucceeded)),j["\u0275\u0275advance"](2),j["\u0275\u0275property"]("ngIf",null==i?null:i.hasFailed),j["\u0275\u0275advance"](2),j["\u0275\u0275property"]("ngIf",!i||!n||(null==i?null:i.isLoading)||(null==n?null:n.isLoading))}}function R(t,e){if(1&t&&(j["\u0275\u0275elementContainerStart"](0),j["\u0275\u0275text"](1,"\n  "),j["\u0275\u0275template"](2,_,8,3,"div",1),j["\u0275\u0275pipe"](3,"async"),j["\u0275\u0275text"](4,"\n"),j["\u0275\u0275elementContainerEnd"]()),2&t){var n=j["\u0275\u0275nextContext"]();j["\u0275\u0275advance"](2),j["\u0275\u0275property"]("ngVar",j["\u0275\u0275pipeBind1"](3,1,n.bitstreamFormatsRD$))}}var X,D,G,U,Y=((X=function(){function t(e,n,i,a,o,s,l,d){r(this,t),this.route=e,this.router=n,this.location=i,this.formService=a,this.translate=o,this.bitstreamService=s,this.notificationsService=l,this.bitstreamFormatService=d,this.KEY_PREFIX="bitstream.edit.form.",this.LABEL_KEY_SUFFIX=".label",this.HINT_KEY_SUFFIX=".hint",this.NOTIFICATIONS_PREFIX="bitstream.edit.notifications.",this.findAllOptions={elementsPerPage:9999},this.fileNameModel=new h.I({id:"fileName",name:"fileName",required:!0,validators:{required:null},errorMessages:{required:"You must provide a file name for the bitstream"}}),this.primaryBitstreamModel=new b.b({id:"primaryBitstream",name:"primaryBitstream"}),this.descriptionModel=new h.O({id:"description",name:"description",rows:10}),this.embargoModel=new h.I({id:"embargo",name:"embargo",disabled:!0}),this.selectedFormatModel=new h.M({id:"selectedFormat",name:"selectedFormat"}),this.newFormatModel=new h.I({id:"newFormat",name:"newFormat"}),this.inputModels=[this.fileNameModel,this.primaryBitstreamModel,this.descriptionModel,this.embargoModel,this.selectedFormatModel,this.newFormatModel],this.formModel=[new h.C({id:"fileNamePrimaryContainer",group:[this.fileNameModel,this.primaryBitstreamModel]}),new h.C({id:"descriptionContainer",group:[this.descriptionModel]}),new h.C({id:"embargoContainer",group:[this.embargoModel]}),new h.C({id:"formatContainer",group:[this.selectedFormatModel,this.newFormatModel]})],this.newFormatBaseLayout="col col-sm-6 d-inline-block",this.formLayout={fileName:{grid:{host:"col col-sm-8 d-inline-block"}},primaryBitstream:{grid:{host:"col col-sm-4 d-inline-block switch"}},description:{grid:{host:"col-12 d-inline-block"}},embargo:{grid:{host:"col-12 d-inline-block"}},selectedFormat:{grid:{host:"col col-sm-6 d-inline-block"}},newFormat:{grid:{host:this.newFormatBaseLayout+" invisible"}},fileNamePrimaryContainer:{grid:{host:"row position-relative"}},descriptionContainer:{grid:{host:"row"}},embargoContainer:{grid:{host:"row"}},formatContainer:{grid:{host:"row"}}},this.subs=[]}return o(t,[{key:"ngOnInit",value:function(){var t=this;this.formGroup=this.formService.createFormGroup(this.formModel),this.itemId=this.route.snapshot.queryParams.itemId,this.entityType=this.route.snapshot.queryParams.entityType,this.bitstreamRD$=this.route.data.pipe(Object(m.a)((function(t){return t.bitstream}))),this.bitstreamFormatsRD$=this.bitstreamFormatService.findAll(this.findAllOptions);var n=this.bitstreamRD$.pipe(Object(y.i)(),Object(y.o)()),i=this.bitstreamFormatsRD$.pipe(Object(y.i)(),Object(y.o)());this.subs.push(Object(p.a)(n,i).subscribe((function(n){var i=e(n,2),r=i[0],a=i[1];t.bitstream=r,t.formats=a.page,t.updateFormatModel(),t.updateForm(t.bitstream)}))),this.updateFieldTranslations(),this.subs.push(this.translate.onLangChange.subscribe((function(){t.updateFieldTranslations()})))}},{key:"updateForm",value:function(t){var e=this;this.formGroup.patchValue({fileNamePrimaryContainer:{fileName:t.name,primaryBitstream:!1},descriptionContainer:{description:t.firstMetadataValue("dc.description")},formatContainer:{newFormat:Object(F.b)(t.firstMetadata("dc.format"))?t.firstMetadata("dc.format").value:void 0}}),this.bitstream.format.pipe(Object(y.d)()).subscribe((function(t){e.originalFormat=t,e.formGroup.patchValue({formatContainer:{selectedFormat:t.id}}),e.updateNewFormatLayout(t.id)}))}},{key:"updateFormatModel",value:function(){var t=this;this.selectedFormatModel.options=this.formats.map((function(e){return Object.assign({value:e.id,label:t.isUnknownFormat(e.id)?t.translate.instant(t.KEY_PREFIX+"selectedFormat.unknown"):e.shortDescription})}))}},{key:"updateNewFormatLayout",value:function(t){this.formLayout.newFormat.grid.host=this.isUnknownFormat(t)?this.newFormatBaseLayout:this.newFormatBaseLayout+" invisible"}},{key:"isUnknownFormat",value:function(t){var e=this.formats.find((function(e){return e.id===t}));return Object(F.b)(e)&&e.supportLevel===g.a.Unknown}},{key:"updateFieldTranslations",value:function(){var t=this;this.inputModels.forEach((function(e){t.updateFieldTranslation(e)}))}},{key:"updateFieldTranslation",value:function(t){t.label=this.translate.instant(this.KEY_PREFIX+t.id+this.LABEL_KEY_SUFFIX),t.id!==this.primaryBitstreamModel.id&&(t.hint=this.translate.instant(this.KEY_PREFIX+t.id+this.HINT_KEY_SUFFIX))}},{key:"onChange",value:function(t){var e=t.model;e.id===this.selectedFormatModel.id&&this.updateNewFormatLayout(e.value)}},{key:"onSubmit",value:function(){var t=this,e=this.formGroup.getRawValue(),n=this.formToBitstream(e),i=this.formats.find((function(t){return t.id===e.formatContainer.selectedFormat}));(i.id!==this.originalFormat.id?this.bitstreamService.updateFormat(this.bitstream,i).pipe(Object(y.g)(),Object(m.a)((function(e){if(!Object(F.b)(e)||!e.hasFailed)return e.payload;t.notificationsService.error(t.translate.instant(t.NOTIFICATIONS_PREFIX+"error.format.title"),e.errorMessage)}))):Object(f.a)(this.bitstream)).pipe(Object(c.a)((function(){return t.bitstreamService.update(n).pipe(Object(y.j)())}))).subscribe((function(){t.bitstreamService.commitUpdates(),t.notificationsService.success(t.translate.instant(t.NOTIFICATIONS_PREFIX+"saved.title"),t.translate.instant(t.NOTIFICATIONS_PREFIX+"saved.content")),t.navigateToItemEditBitstreams()}))}},{key:"formToBitstream",value:function(t){var e=Object(v.cloneDeep)(this.bitstream),n=e.metadata;return w.a.setFirstValue(n,"dc.title",t.fileNamePrimaryContainer.fileName),w.a.setFirstValue(n,"dc.description",t.descriptionContainer.description),Object(F.e)(t.formatContainer.newFormat)&&w.a.setFirstValue(n,"dc.format",t.formatContainer.newFormat),e.metadata=n,e}},{key:"onCancel",value:function(){this.navigateToItemEditBitstreams()}},{key:"navigateToItemEditBitstreams",value:function(){var t=this;Object(F.b)(this.itemId)?this.router.navigate([Object(I.d)(this.entityType,this.itemId),"bitstreams"]):this.bitstream.bundle.pipe(Object(y.j)(),Object(u.a)((function(t){return t.item.pipe(Object(y.j)())}))).subscribe((function(e){t.router.navigate([Object(I.e)(e),"bitstreams"])}))}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(t){return Object(F.b)(t)})).forEach((function(t){return t.unsubscribe()}))}}]),t}()).\u0275fac=function(t){return new(t||X)(j["\u0275\u0275directiveInject"](d.a),j["\u0275\u0275directiveInject"](d.g),j["\u0275\u0275directiveInject"](s.o),j["\u0275\u0275directiveInject"](h.F),j["\u0275\u0275directiveInject"](O.f),j["\u0275\u0275directiveInject"](S.a),j["\u0275\u0275directiveInject"](C.a),j["\u0275\u0275directiveInject"](M.a))},X.\u0275cmp=j["\u0275\u0275defineComponent"]({type:X,selectors:[["ds-edit-bitstream-page"]],decls:3,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngVar"],[1,"container"],["class","row",4,"ngIf"],[3,"message",4,"ngIf"],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"col-12"],[1,"text-muted"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange"],[3,"message"]],template:function(t,e){1&t&&(j["\u0275\u0275template"](0,R,5,3,"ng-container",0),j["\u0275\u0275pipe"](1,"async"),j["\u0275\u0275text"](2,"\n")),2&t&&j["\u0275\u0275property"]("ngVar",j["\u0275\u0275pipeBind1"](1,1,e.bitstreamRD$))},directives:[x.a,s.u,E.a,k.a,N.NgControlStatusGroup,N.FormGroupDirective,B.a,L.a],pipes:[s.b,T.a,O.e],styles:["[_nghost-%COMP%]     .switch{position:absolute;top:calc(var(--bs-spacer) * 2.5)}"],changeDetection:0}),X),q=a("tPZA"),K=a("84Zn"),$=((D=function(){function e(t){r(this,e),this.bitstreamService=t}return o(e,[{key:"resolve",value:function(e,n){var i;return(i=this.bitstreamService).findById.apply(i,[e.params.id,!0,!1].concat(t(this.followLinks))).pipe(Object(y.g)())}},{key:"followLinks",get:function(){return[Object(K.a)("bundle",void 0,!0,!0,!0,Object(K.a)("item")),Object(K.a)("format")]}}]),e}()).\u0275fac=function(t){return new(t||D)(j["\u0275\u0275inject"](S.a))},D.\u0275prov=j["\u0275\u0275defineInjectable"]({token:D,factory:D.\u0275fac}),D),J=a("Gt6B"),Z=((U=function t(){r(this,t)}).\u0275mod=j["\u0275\u0275defineNgModule"]({type:U}),U.\u0275inj=j["\u0275\u0275defineInjector"]({factory:function(t){return new(t||U)},providers:[$],imports:[[d.k.forChild([{path:":id/download",component:J.a,resolve:{bitstream:$}},{path:":id/edit",component:Y,resolve:{bitstream:$},canActivate:[q.a]}])]]}),U),H=((G=function t(){r(this,t)}).\u0275mod=j["\u0275\u0275defineNgModule"]({type:G}),G.\u0275inj=j["\u0275\u0275defineInjector"]({factory:function(t){return new(t||G)},imports:[[s.c,l.a,Z]]}),G)}}])}();
//# sourceMappingURL=37-es5.641c8928382911b9330f.js.map