{"version":3,"sources":["webpack:///src/app/profile-page/profile-page-security-form/profile-page-security-form.component.ts","webpack:///src/app/profile-page/profile-page-security-form/profile-page-security-form.component.html"],"names":["ProfilePageSecurityFormComponent","formService","translate","epersonService","notificationsService","isInvalid","EventEmitter","passwordValue","formModel","id","name","inputType","passwordCanBeEmpty","subs","this","formGroup","createFormGroup","validators","checkPasswordsEqual","checkPasswordLength","checkPasswordEmpty","updateFieldTranslations","onLangChange","subscribe","push","statusChanges","pipe","status","emit","valueChanges","valueChange","password","forEach","fieldModel","label","instant","FORM_PREFIX","group","get","value","notSame","pass","length","notLongEnough","emptyPassword","filter","sub","unsubscribe"],"mappings":"8QAAA,0K,yBCCA,6CAMA,6D,0CALS,kDAAsB,wBAAtB,CAAsB,wBAAtB,CAAsB,mBAAtB,CAAsB,qB,yBAM/B,yCAAwG,yB,qCAAqD,+B,0CAArD,qI,yBACxG,yCAA4F,yB,qCAAwD,+B,0CAAxD,wI,yBAC5F,yCAAkJ,yB,qCAAoD,+B,0CAApD,oIDQ3I,qBAAMA,EAAN,WA6CL,WAAsBC,EACAC,EACAC,EACAC,I,4FAAAA,SAHA,KAAAH,cACA,KAAAC,YACA,KAAAC,iBACA,KAAAC,uBA3CZ,KAAAC,UAAY,IAAI,EAAAC,aAIhB,KAAAC,cAAgB,IAAI,EAAAD,aAK9B,KAAAE,UAAuC,CACrC,IAAI,IAAkB,CACpBC,GAAI,WACJC,KAAM,WACNC,UAAW,aAEb,IAAI,IAAkB,CACpBF,GAAI,iBACJC,KAAM,iBACNC,UAAW,cAaf,KAAAC,sBAOQ,KAAAC,KAAuB,G,UA3C1B,O,EAAA,G,EAAA,kCAmDK,WAENC,KAAKC,UAAYD,KAAKb,YAAYe,gBAAgBF,KAAKN,UADrDM,KAAKF,mBAEL,CAACK,WAAY,CAACH,KAAKI,oBAAqBJ,KAAKK,sBAG7C,CAACF,WAAY,CAACH,KAAKI,oBAAqBJ,KAAKK,oBAAqBL,KAAKM,sBAE3EN,KAAKO,0BACLP,KAAKZ,UAAUoB,aACZC,WAAU,WACTT,EAAKO,6BAGTP,KAAKD,KAAKW,KAAKV,KAAKC,UAAUU,cAAcC,KAC1C,YAAa,KACb,aAAKC,YAAMA,MACM,UAAXA,MAKFJ,WAAWI,YAAMA,OAAKb,EAAKT,UAAUuB,KAAKD,OAGhDb,KAAKD,KAAKW,KAAKV,KAAKC,UAAUc,aAAaH,KACzC,YAAa,MACbH,WAAWO,YACXhB,EAAKP,cAAcqB,KAAKE,EAAYC,gBA/EnC,gDAsFoB,WACvBjB,KAAKN,UAAUwB,SACZC,YACCA,EAAWC,MAAQpB,EAAKZ,UAAUiC,QAAQrB,EAAKsB,YAAc,SAAWH,EAAWxB,SAzFpF,0CAkGe4B,GAIlB,OAHaA,EAAMC,IAAI,YAAYC,QAChBF,EAAMC,IAAI,kBAAkBC,MAElB,KAAO,CAACC,SAAQA,KAtG1C,0CA6GeH,GAClB,IAAMI,EAAOJ,EAAMC,IAAI,YAAYC,MAEnC,OAAO,YAAQE,IAASA,EAAKC,QAAU,EAAI,KAAO,CAACC,eAAcA,KAhH9D,yCAuHcN,GACjB,IAAMI,EAAOJ,EAAMC,IAAI,YAAYC,MACnC,OAAO,YAAQE,GAAQ,CAACG,eAAcA,GAAS,OAzH5C,oCAgIH9B,KAAKD,KACFgC,QAAQC,YAAGA,OAAK,YAASA,MACzBd,SAASc,YAAGA,OAAKA,EAAIC,sB,2BAlIrB,K,6CAAM/C,GAAgC,0J,mDAAhCA,EAAgC,8wBClB7C,yCAAkC,yB,qCAAoC,8BACtE,6EAOA,yEACA,yEACA,0EACA,gC,MAXkC,mHACzB,0EAOmD,oGACN,8FACM,gJ,iGDQrD,O","file":"x","sourcesContent":["import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport { DynamicFormControlModel, DynamicFormService, DynamicInputModel } from '@ng-dynamic-forms/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { FormGroup } from '@angular/forms';\nimport { hasValue, isEmpty } from '../../shared/empty.util';\nimport { EPersonDataService } from '../../core/eperson/eperson-data.service';\nimport { NotificationsService } from '../../shared/notifications/notifications.service';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { Subscription } from 'rxjs';\n\n@Component({\n  selector: 'ds-profile-page-security-form',\n  templateUrl: './profile-page-security-form.component.html'\n})\n/**\n * Component for a user to edit their security information\n * Displays a form containing a password field and a confirmation of the password\n */\nexport class ProfilePageSecurityFormComponent implements OnInit {\n\n  /**\n   * Emits the validity of the password\n   */\n  @Output() isInvalid = new EventEmitter<boolean>();\n  /**\n   * Emits the value of the password\n   */\n  @Output() passwordValue = new EventEmitter<string>();\n\n  /**\n   * The form's input models\n   */\n  formModel: DynamicFormControlModel[] = [\n    new DynamicInputModel({\n      id: 'password',\n      name: 'password',\n      inputType: 'password'\n    }),\n    new DynamicInputModel({\n      id: 'passwordrepeat',\n      name: 'passwordrepeat',\n      inputType: 'password'\n    })\n  ];\n\n  /**\n   * The form group of this form\n   */\n  formGroup: FormGroup;\n\n  /**\n   * Indicates whether the \"checkPasswordEmpty\" needs to be added or not\n   */\n  @Input()\n  passwordCanBeEmpty = true;\n\n  /**\n   * Prefix for the form's label messages of this component\n   */\n  @Input()\n  FORM_PREFIX: string;\n  private subs: Subscription[] = [];\n\n  constructor(protected formService: DynamicFormService,\n              protected translate: TranslateService,\n              protected epersonService: EPersonDataService,\n              protected notificationsService: NotificationsService) {\n  }\n\n  ngOnInit(): void {\n    if (this.passwordCanBeEmpty) {\n      this.formGroup = this.formService.createFormGroup(this.formModel,\n        {validators: [this.checkPasswordsEqual, this.checkPasswordLength]});\n    } else {\n      this.formGroup = this.formService.createFormGroup(this.formModel,\n        {validators: [this.checkPasswordsEqual, this.checkPasswordLength, this.checkPasswordEmpty]});\n    }\n    this.updateFieldTranslations();\n    this.translate.onLangChange\n      .subscribe(() => {\n        this.updateFieldTranslations();\n      });\n\n    this.subs.push(this.formGroup.statusChanges.pipe(\n      debounceTime(300),\n      map((status: string) => {\n        if (status !== 'VALID') {\n          return true;\n        } else {\n          return false;\n        }\n      })).subscribe((status) => this.isInvalid.emit(status))\n    );\n\n    this.subs.push(this.formGroup.valueChanges.pipe(\n      debounceTime(300),\n    ).subscribe((valueChange) => {\n      this.passwordValue.emit(valueChange.password);\n    }));\n  }\n\n  /**\n   * Update the translations of the field labels\n   */\n  updateFieldTranslations() {\n    this.formModel.forEach(\n      (fieldModel: DynamicInputModel) => {\n        fieldModel.label = this.translate.instant(this.FORM_PREFIX + 'label.' + fieldModel.id);\n      }\n    );\n  }\n\n  /**\n   * Check if both password fields are filled in and equal\n   * @param group The FormGroup to validate\n   */\n  checkPasswordsEqual(group: FormGroup) {\n    const pass = group.get('password').value;\n    const repeatPass = group.get('passwordrepeat').value;\n\n    return pass === repeatPass ? null : {notSame: true};\n  }\n\n  /**\n   * Check if the password is at least 6 characters long\n   * @param group The FormGroup to validate\n   */\n  checkPasswordLength(group: FormGroup) {\n    const pass = group.get('password').value;\n\n    return isEmpty(pass) || pass.length >= 6 ? null : {notLongEnough: true};\n  }\n\n  /**\n   * Checks if the password is empty\n   * @param group The FormGroup to validate\n   */\n  checkPasswordEmpty(group: FormGroup) {\n    const pass = group.get('password').value;\n    return isEmpty(pass) ? {emptyPassword: true} : null;\n  }\n\n  /**\n   * Unsubscribe from all subscriptions\n   */\n  ngOnDestroy(): void {\n    this.subs\n      .filter((sub) => hasValue(sub))\n      .forEach((sub) => sub.unsubscribe());\n  }\n}\n","<div class=\"container-fluid mb-4\">{{FORM_PREFIX + 'info' | translate}}</div>\n<ds-form *ngIf=\"formModel\"\n         [formId]=\"FORM_PREFIX\"\n         [formModel]=\"formModel\"\n         [formGroup]=\"formGroup\"\n         [displaySubmit]=\"false\"\n         [displayCancel]=\"false\">\n</ds-form>\n<div id=\"notLongEnough\" class=\"container-fluid text-danger\" *ngIf=\"formGroup.hasError('notLongEnough')\">{{FORM_PREFIX + 'error.password-length' | translate}}</div>\n<div id=\"notSame\" class=\"container-fluid text-danger\" *ngIf=\"formGroup.hasError('notSame')\">{{FORM_PREFIX + 'error.matching-passwords' | translate}}</div>\n<div id=\"emptyPassword\" class=\"container-fluid text-danger\" *ngIf=\"(formGroup.dirty || formGroup.touched) && formGroup.hasError('emptyPassword')\">{{FORM_PREFIX + 'error.empty-password' | translate}}</div>\n"]}