"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (this && this.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockBuilderPerformance = void 0;
var testing_1 = require("@angular/core/testing");
var core_helpers_1 = require("../common/core.helpers");
var ng_mocks_universe_1 = require("../common/ng-mocks-universe");
var mock_builder_promise_1 = require("./mock-builder-promise");
var MockBuilderPerformance = /** @class */ (function (_super) {
    __extends(MockBuilderPerformance, _super);
    function MockBuilderPerformance() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    MockBuilderPerformance.prototype.build = function () {
        var e_1, _a, e_2, _b, e_3, _c, e_4, _d, e_5, _e, e_6, _f, e_7, _g, e_8, _h, e_9, _j;
        var ngModule;
        if (ng_mocks_universe_1.default.global.has('builder:module') &&
            ng_mocks_universe_1.default.global.has('builder:config') &&
            this.equalsTo(ng_mocks_universe_1.default.global.get('builder:config'))) {
            ngModule = ng_mocks_universe_1.default.global.get('builder:module');
            // avoiding influences on cache when users extend the testing module.
            return {
                declarations: __spread(ngModule.declarations),
                imports: __spread(ngModule.imports),
                providers: __spread(ngModule.providers),
            };
        }
        // removal of cached promise in case of mismatch
        if (ng_mocks_universe_1.default.global.has('builder:module')) {
            ng_mocks_universe_1.default.global.delete(ng_mocks_universe_1.default.global.get('builder:module'));
        }
        var initialConfig = {
            beforeCC: new Set(),
            configDef: new Map(),
            defProviders: new Map(),
            defValue: new Map(),
            excludeDef: new Set(),
            keepDef: new Set(),
            mockDef: new Set(),
            providerDef: new Map(),
            replaceDef: new Set(),
        };
        try {
            for (var _k = __values(core_helpers_1.mapValues(this.beforeCC)), _l = _k.next(); !_l.done; _l = _k.next()) {
                var value = _l.value;
                initialConfig.beforeCC.add(value);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_l && !_l.done && (_a = _k.return)) _a.call(_k);
            }
            finally { if (e_1) throw e_1.error; }
        }
        try {
            for (var _m = __values(core_helpers_1.mapEntries(this.configDef)), _o = _m.next(); !_o.done; _o = _m.next()) {
                var _p = __read(_o.value, 2), key = _p[0], value = _p[1];
                initialConfig.configDef.set(key, value);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_o && !_o.done && (_b = _m.return)) _b.call(_m);
            }
            finally { if (e_2) throw e_2.error; }
        }
        try {
            for (var _q = __values(core_helpers_1.mapEntries(this.defProviders)), _r = _q.next(); !_r.done; _r = _q.next()) {
                var _s = __read(_r.value, 2), key = _s[0], value = _s[1];
                initialConfig.defProviders.set(key, value);
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_r && !_r.done && (_c = _q.return)) _c.call(_q);
            }
            finally { if (e_3) throw e_3.error; }
        }
        try {
            for (var _t = __values(core_helpers_1.mapEntries(this.defValue)), _u = _t.next(); !_u.done; _u = _t.next()) {
                var _v = __read(_u.value, 2), key = _v[0], value = _v[1];
                initialConfig.defValue.set(key, value);
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_u && !_u.done && (_d = _t.return)) _d.call(_t);
            }
            finally { if (e_4) throw e_4.error; }
        }
        try {
            for (var _w = __values(core_helpers_1.mapValues(this.excludeDef)), _x = _w.next(); !_x.done; _x = _w.next()) {
                var value = _x.value;
                initialConfig.excludeDef.add(value);
            }
        }
        catch (e_5_1) { e_5 = { error: e_5_1 }; }
        finally {
            try {
                if (_x && !_x.done && (_e = _w.return)) _e.call(_w);
            }
            finally { if (e_5) throw e_5.error; }
        }
        try {
            for (var _y = __values(core_helpers_1.mapValues(this.keepDef)), _z = _y.next(); !_z.done; _z = _y.next()) {
                var value = _z.value;
                initialConfig.keepDef.add(value);
            }
        }
        catch (e_6_1) { e_6 = { error: e_6_1 }; }
        finally {
            try {
                if (_z && !_z.done && (_f = _y.return)) _f.call(_y);
            }
            finally { if (e_6) throw e_6.error; }
        }
        try {
            for (var _0 = __values(core_helpers_1.mapValues(this.mockDef)), _1 = _0.next(); !_1.done; _1 = _0.next()) {
                var value = _1.value;
                initialConfig.mockDef.add(value);
            }
        }
        catch (e_7_1) { e_7 = { error: e_7_1 }; }
        finally {
            try {
                if (_1 && !_1.done && (_g = _0.return)) _g.call(_0);
            }
            finally { if (e_7) throw e_7.error; }
        }
        try {
            for (var _2 = __values(core_helpers_1.mapEntries(this.providerDef)), _3 = _2.next(); !_3.done; _3 = _2.next()) {
                var _4 = __read(_3.value, 2), key = _4[0], value = _4[1];
                initialConfig.providerDef.set(key, value);
            }
        }
        catch (e_8_1) { e_8 = { error: e_8_1 }; }
        finally {
            try {
                if (_3 && !_3.done && (_h = _2.return)) _h.call(_2);
            }
            finally { if (e_8) throw e_8.error; }
        }
        try {
            for (var _5 = __values(core_helpers_1.mapValues(this.replaceDef)), _6 = _5.next(); !_6.done; _6 = _5.next()) {
                var value = _6.value;
                initialConfig.replaceDef.add(value);
            }
        }
        catch (e_9_1) { e_9 = { error: e_9_1 }; }
        finally {
            try {
                if (_6 && !_6.done && (_j = _5.return)) _j.call(_5);
            }
            finally { if (e_9) throw e_9.error; }
        }
        ng_mocks_universe_1.default.global.set('builder:config', initialConfig);
        ngModule = _super.prototype.build.call(this);
        ng_mocks_universe_1.default.global.set('builder:module', ngModule);
        // avoiding influences on cache when users extend the testing module.
        return {
            declarations: __spread(ngModule.declarations),
            imports: __spread(ngModule.imports),
            providers: __spread(ngModule.providers),
        };
    };
    MockBuilderPerformance.prototype.then = function (fulfill, reject) {
        if (ng_mocks_universe_1.default.global.has('bullet') &&
            ng_mocks_universe_1.default.global.has('builder:module') &&
            ng_mocks_universe_1.default.global.has('builder:config') &&
            this.equalsTo(ng_mocks_universe_1.default.global.get('builder:config'))) {
            return ng_mocks_universe_1.default.global.get(ng_mocks_universe_1.default.global.get('builder:module')).then(fulfill, reject);
        }
        // we need to reset testing module in case if we are in bullet mode but current module doesn't match.
        if (ng_mocks_universe_1.default.global.has('bullet') && ng_mocks_universe_1.default.global.has('bullet:reset')) {
            // tslint:disable-next-line:no-console
            console.warn('ngMocks.faster has zero effect due to changes in testing module between runs');
            ng_mocks_universe_1.default.global.delete('bullet');
            testing_1.TestBed.resetTestingModule();
            ng_mocks_universe_1.default.global.set('bullet', true);
        }
        var promise = _super.prototype.then.call(this, fulfill, reject);
        ng_mocks_universe_1.default.global.set(ng_mocks_universe_1.default.global.get('builder:module'), promise);
        return promise;
    };
    // tslint:disable-next-line:prefer-function-over-method
    MockBuilderPerformance.prototype.equalProviders = function (prototype, source) {
        // a case of multi vs non-multi
        if (Array.isArray(prototype) !== Array.isArray(source)) {
            return false;
        }
        var prototypeDefs = core_helpers_1.flatten(prototype);
        var thisDefs = core_helpers_1.flatten(source);
        if (prototypeDefs.length !== thisDefs.length) {
            return false;
        }
        for (var index = 0; index < prototypeDefs.length; index += 1) {
            var prototypeDef = prototypeDefs[index];
            var thisDef = thisDefs[index];
            if (prototypeDef && thisDef && prototypeDef.multi !== thisDef.multi) {
                return false;
            }
            if (prototypeDef &&
                thisDef &&
                prototypeDef.useValue &&
                thisDef.useValue &&
                prototypeDef.useValue === thisDef.useValue) {
                continue;
            }
            if (prototypeDef &&
                thisDef &&
                prototypeDef.useClass &&
                thisDef.useClass &&
                prototypeDef.useClass === thisDef.useClass) {
                continue;
            }
            if (prototypeDef &&
                thisDef &&
                prototypeDef.useFactory &&
                thisDef.useFactory &&
                prototypeDef.useFactory === thisDef.useFactory) {
                continue;
            }
            if (prototypeDef &&
                thisDef &&
                prototypeDef.useExisting &&
                thisDef.useExisting &&
                prototypeDef.useExisting === thisDef.useExisting) {
                continue;
            }
            if (prototypeDef === thisDef) {
                continue;
            }
            return false;
        }
        return true;
    };
    // tslint:disable-next-line:prefer-function-over-method
    MockBuilderPerformance.prototype.equalRender = function (prototype, source) {
        if (prototype === source) {
            return true;
        }
        if ((typeof prototype === 'boolean' || typeof source === 'boolean') && prototype !== source) {
            return false;
        }
        if (prototype.$implicit !== source.$implicit) {
            return false;
        }
        if (!this.equalVariables(prototype.variables, source.variables)) {
            return false;
        }
        return true;
    };
    MockBuilderPerformance.prototype.equalsTo = function (prototype) {
        var e_10, _a, e_11, _b, e_12, _c, e_13, _d, e_14, _e, e_15, _f, e_16, _g, e_17, _h, e_18, _j, e_19, _k;
        if (!prototype.beforeCC || prototype.beforeCC.size !== this.beforeCC.size) {
            return false;
        }
        try {
            for (var _l = __values(core_helpers_1.mapValues(this.beforeCC)), _m = _l.next(); !_m.done; _m = _l.next()) {
                var value = _m.value;
                if (!prototype.beforeCC.has(value)) {
                    return false;
                }
            }
        }
        catch (e_10_1) { e_10 = { error: e_10_1 }; }
        finally {
            try {
                if (_m && !_m.done && (_a = _l.return)) _a.call(_l);
            }
            finally { if (e_10) throw e_10.error; }
        }
        if (!prototype.keepDef || prototype.keepDef.size !== this.keepDef.size) {
            return false;
        }
        try {
            for (var _o = __values(core_helpers_1.mapValues(this.keepDef)), _p = _o.next(); !_p.done; _p = _o.next()) {
                var value = _p.value;
                if (!prototype.keepDef.has(value)) {
                    return false;
                }
            }
        }
        catch (e_11_1) { e_11 = { error: e_11_1 }; }
        finally {
            try {
                if (_p && !_p.done && (_b = _o.return)) _b.call(_o);
            }
            finally { if (e_11) throw e_11.error; }
        }
        if (!prototype.replaceDef || prototype.replaceDef.size !== this.replaceDef.size) {
            return false;
        }
        try {
            for (var _q = __values(core_helpers_1.mapValues(this.replaceDef)), _r = _q.next(); !_r.done; _r = _q.next()) {
                var value = _r.value;
                if (!prototype.replaceDef.has(value)) {
                    return false;
                }
            }
        }
        catch (e_12_1) { e_12 = { error: e_12_1 }; }
        finally {
            try {
                if (_r && !_r.done && (_c = _q.return)) _c.call(_q);
            }
            finally { if (e_12) throw e_12.error; }
        }
        if (!prototype.excludeDef || prototype.excludeDef.size !== this.excludeDef.size) {
            return false;
        }
        try {
            for (var _s = __values(core_helpers_1.mapValues(this.excludeDef)), _t = _s.next(); !_t.done; _t = _s.next()) {
                var value = _t.value;
                if (!prototype.excludeDef.has(value)) {
                    return false;
                }
            }
        }
        catch (e_13_1) { e_13 = { error: e_13_1 }; }
        finally {
            try {
                if (_t && !_t.done && (_d = _s.return)) _d.call(_s);
            }
            finally { if (e_13) throw e_13.error; }
        }
        if (!prototype.mockDef || prototype.mockDef.size !== this.mockDef.size) {
            return false;
        }
        try {
            for (var _u = __values(core_helpers_1.mapValues(this.mockDef)), _v = _u.next(); !_v.done; _v = _u.next()) {
                var value = _v.value;
                if (!prototype.mockDef.has(value)) {
                    return false;
                }
            }
        }
        catch (e_14_1) { e_14 = { error: e_14_1 }; }
        finally {
            try {
                if (_v && !_v.done && (_e = _u.return)) _e.call(_u);
            }
            finally { if (e_14) throw e_14.error; }
        }
        if (!prototype.providerDef || prototype.providerDef.size !== this.providerDef.size) {
            return false;
        }
        try {
            for (var _w = __values(core_helpers_1.mapKeys(this.providerDef)), _x = _w.next(); !_x.done; _x = _w.next()) {
                var value = _x.value;
                if (!prototype.providerDef.has(value)) {
                    return false;
                }
                if (!this.equalProviders(prototype.providerDef.get(value), this.providerDef.get(value))) {
                    return false;
                }
            }
        }
        catch (e_15_1) { e_15 = { error: e_15_1 }; }
        finally {
            try {
                if (_x && !_x.done && (_f = _w.return)) _f.call(_w);
            }
            finally { if (e_15) throw e_15.error; }
        }
        if (!prototype.defProviders || prototype.defProviders.size !== this.defProviders.size) {
            return false;
        }
        try {
            for (var _y = __values(core_helpers_1.mapKeys(this.defProviders)), _z = _y.next(); !_z.done; _z = _y.next()) {
                var value = _z.value;
                if (!prototype.defProviders.has(value)) {
                    return false;
                }
                if (!this.equalProviders(prototype.defProviders.get(value), this.defProviders.get(value))) {
                    return false;
                }
            }
        }
        catch (e_16_1) { e_16 = { error: e_16_1 }; }
        finally {
            try {
                if (_z && !_z.done && (_g = _y.return)) _g.call(_y);
            }
            finally { if (e_16) throw e_16.error; }
        }
        if (!prototype.defValue || prototype.defValue.size !== this.defValue.size) {
            return false;
        }
        try {
            for (var _0 = __values(core_helpers_1.mapKeys(this.defValue)), _1 = _0.next(); !_1.done; _1 = _0.next()) {
                var value = _1.value;
                if (!prototype.defValue.has(value)) {
                    return false;
                }
                if (prototype.defValue.get(value) !== this.defValue.get(value)) {
                    return false;
                }
            }
        }
        catch (e_17_1) { e_17 = { error: e_17_1 }; }
        finally {
            try {
                if (_1 && !_1.done && (_h = _0.return)) _h.call(_0);
            }
            finally { if (e_17) throw e_17.error; }
        }
        if (!prototype.configDef || prototype.configDef.size !== this.configDef.size) {
            return false;
        }
        try {
            for (var _2 = __values(core_helpers_1.mapKeys(this.configDef)), _3 = _2.next(); !_3.done; _3 = _2.next()) {
                var value = _3.value;
                if (!prototype.configDef.has(value)) {
                    return false;
                }
                var configPrototype = prototype.configDef.get(value);
                var configThis = this.configDef.get(value);
                if (configPrototype === configThis) {
                    continue;
                }
                if (configPrototype.dependency !== configThis.dependency) {
                    return false;
                }
                if (configPrototype.export !== configThis.export) {
                    return false;
                }
                if (configPrototype.exportAll !== configThis.exportAll) {
                    return false;
                }
                if (!this.equalRender(configPrototype.render, configThis.render)) {
                    return false;
                }
                if (typeof configPrototype.render !== 'object' || typeof configThis.render !== 'object') {
                    continue;
                }
                if (Object.keys(configPrototype.render).length !== Object.keys(configThis.render).length) {
                    return false;
                }
                try {
                    for (var _4 = (e_19 = void 0, __values(Object.keys(configPrototype.render))), _5 = _4.next(); !_5.done; _5 = _4.next()) {
                        var key = _5.value;
                        if (!this.equalRender(configPrototype.render[key], configThis.render[key])) {
                            return false;
                        }
                    }
                }
                catch (e_19_1) { e_19 = { error: e_19_1 }; }
                finally {
                    try {
                        if (_5 && !_5.done && (_k = _4.return)) _k.call(_4);
                    }
                    finally { if (e_19) throw e_19.error; }
                }
            }
        }
        catch (e_18_1) { e_18 = { error: e_18_1 }; }
        finally {
            try {
                if (_3 && !_3.done && (_j = _2.return)) _j.call(_2);
            }
            finally { if (e_18) throw e_18.error; }
        }
        return true;
    };
    // tslint:disable-next-line:prefer-function-over-method
    MockBuilderPerformance.prototype.equalVariables = function (prototype, source) {
        var e_20, _a;
        if (prototype === source) {
            return true;
        }
        if (prototype && !source) {
            return false;
        }
        if (!prototype && source) {
            return false;
        }
        var prototypeKeys = Object.keys(prototype);
        var sourceKeys = Object.keys(source);
        if (prototypeKeys.length !== sourceKeys.length) {
            return false;
        }
        try {
            for (var prototypeKeys_1 = __values(prototypeKeys), prototypeKeys_1_1 = prototypeKeys_1.next(); !prototypeKeys_1_1.done; prototypeKeys_1_1 = prototypeKeys_1.next()) {
                var key = prototypeKeys_1_1.value;
                if (prototype[key] !== source[key]) {
                    return false;
                }
            }
        }
        catch (e_20_1) { e_20 = { error: e_20_1 }; }
        finally {
            try {
                if (prototypeKeys_1_1 && !prototypeKeys_1_1.done && (_a = prototypeKeys_1.return)) _a.call(prototypeKeys_1);
            }
            finally { if (e_20) throw e_20.error; }
        }
        return true;
    };
    return MockBuilderPerformance;
}(mock_builder_promise_1.MockBuilderPromise));
exports.MockBuilderPerformance = MockBuilderPerformance;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9jay1idWlsZGVyLXBlcmZvcm1hbmNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL21vY2stYnVpbGRlci9tb2NrLWJ1aWxkZXItcGVyZm9ybWFuY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSxpREFBb0U7QUFFcEUsdURBQWlGO0FBQ2pGLGlFQUEwRDtBQUUxRCwrREFBNEQ7QUFHNUQ7SUFBNEMsMENBQWtCO0lBQTlEOztJQXdVQSxDQUFDO0lBdlVRLHNDQUFLLEdBQVo7O1FBQ0UsSUFBSSxRQUE0QixDQUFDO1FBRWpDLElBQ0UsMkJBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDO1lBQzVDLDJCQUFlLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQztZQUM1QyxJQUFJLENBQUMsUUFBUSxDQUFDLDJCQUFlLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEVBQzNEO1lBQ0EsUUFBUSxHQUFHLDJCQUFlLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXhELHFFQUFxRTtZQUNyRSxPQUFPO2dCQUNMLFlBQVksV0FBTSxRQUFRLENBQUMsWUFBWSxDQUFDO2dCQUN4QyxPQUFPLFdBQU0sUUFBUSxDQUFDLE9BQU8sQ0FBQztnQkFDOUIsU0FBUyxXQUFNLFFBQVEsQ0FBQyxTQUFTLENBQUM7YUFDbkMsQ0FBQztTQUNIO1FBRUQsZ0RBQWdEO1FBQ2hELElBQUksMkJBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLEVBQUU7WUFDaEQsMkJBQWUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLDJCQUFlLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7U0FDN0U7UUFFRCxJ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QUNkLENBQUM7SUFDSCw2QkFBQztBQUFELENBQUMsQUF4VUQsQ0FBNEMseUNBQWtCLEdBd1U3RDtBQXhVWSx3REFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGVzdEJlZCwgVGVzdE1vZHVsZU1ldGFkYXRhIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcblxuaW1wb3J0IHsgZmxhdHRlbiwgbWFwRW50cmllcywgbWFwS2V5cywgbWFwVmFsdWVzIH0gZnJvbSAnLi4vY29tbW9uL2NvcmUuaGVscGVycyc7XG5pbXBvcnQgbmdNb2Nrc1VuaXZlcnNlIGZyb20gJy4uL2NvbW1vbi9uZy1tb2Nrcy11bml2ZXJzZSc7XG5cbmltcG9ydCB7IE1vY2tCdWlsZGVyUHJvbWlzZSB9IGZyb20gJy4vbW9jay1idWlsZGVyLXByb21pc2UnO1xuaW1wb3J0IHsgSU1vY2tCdWlsZGVyUmVzdWx0IH0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBNb2NrQnVpbGRlclBlcmZvcm1hbmNlIGV4dGVuZHMgTW9ja0J1aWxkZXJQcm9taXNlIHtcbiAgcHVibGljIGJ1aWxkKCk6IE5nTW9kdWxlIHtcbiAgICBsZXQgbmdNb2R1bGU6IFRlc3RNb2R1bGVNZXRhZGF0YTtcblxuICAgIGlmIChcbiAgICAgIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuaGFzKCdidWlsZGVyOm1vZHVsZScpICYmXG4gICAgICBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmhhcygnYnVpbGRlcjpjb25maWcnKSAmJlxuICAgICAgdGhpcy5lcXVhbHNUbyhuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmdldCgnYnVpbGRlcjpjb25maWcnKSlcbiAgICApIHtcbiAgICAgIG5nTW9kdWxlID0gbmdNb2Nrc1VuaXZlcnNlLmdsb2JhbC5nZXQoJ2J1aWxkZXI6bW9kdWxlJyk7XG5cbiAgICAgIC8vIGF2b2lkaW5nIGluZmx1ZW5jZXMgb24gY2FjaGUgd2hlbiB1c2VycyBleHRlbmQgdGhlIHRlc3RpbmcgbW9kdWxlLlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGVjbGFyYXRpb25zOiBbLi4ubmdNb2R1bGUuZGVjbGFyYXRpb25zXSxcbiAgICAgICAgaW1wb3J0czogWy4uLm5nTW9kdWxlLmltcG9ydHNdLFxuICAgICAgICBwcm92aWRlcnM6IFsuLi5uZ01vZHVsZS5wcm92aWRlcnNdLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyByZW1vdmFsIG9mIGNhY2hlZCBwcm9taXNlIGluIGNhc2Ugb2YgbWlzbWF0Y2hcbiAgICBpZiAobmdNb2Nrc1VuaXZlcnNlLmdsb2JhbC5oYXMoJ2J1aWxkZXI6bW9kdWxlJykpIHtcbiAgICAgIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuZGVsZXRlKG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuZ2V0KCdidWlsZGVyOm1vZHVsZScpKTtcbiAgICB9XG5cbiAgICBjb25zdCBpbml0aWFsQ29uZmlnID0ge1xuICAgICAgYmVmb3JlQ0M6IG5ldyBTZXQoKSxcbiAgICAgIGNvbmZpZ0RlZjogbmV3IE1hcCgpLFxuICAgICAgZGVmUHJvdmlkZXJzOiBuZXcgTWFwKCksXG4gICAgICBkZWZWYWx1ZTogbmV3IE1hcCgpLFxuICAgICAgZXhjbHVkZURlZjogbmV3IFNldCgpLFxuICAgICAga2VlcERlZjogbmV3IFNldCgpLFxuICAgICAgbW9ja0RlZjogbmV3IFNldCgpLFxuICAgICAgcHJvdmlkZXJEZWY6IG5ldyBNYXAoKSxcbiAgICAgIHJlcGxhY2VEZWY6IG5ldyBTZXQoKSxcbiAgICB9O1xuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgbWFwVmFsdWVzKHRoaXMuYmVmb3JlQ0MpKSB7XG4gICAgICBpbml0aWFsQ29uZmlnLmJlZm9yZUNDLmFkZCh2YWx1ZSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG1hcEVudHJpZXModGhpcy5jb25maWdEZWYpKSB7XG4gICAgICBpbml0aWFsQ29uZmlnLmNvbmZpZ0RlZi5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG1hcEVudHJpZXModGhpcy5kZWZQcm92aWRlcnMpKSB7XG4gICAgICBpbml0aWFsQ29uZmlnLmRlZlByb3ZpZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG1hcEVudHJpZXModGhpcy5kZWZWYWx1ZSkpIHtcbiAgICAgIGluaXRpYWxDb25maWcuZGVmVmFsdWUuc2V0KGtleSwgdmFsdWUpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIG1hcFZhbHVlcyh0aGlzLmV4Y2x1ZGVEZWYpKSB7XG4gICAgICBpbml0aWFsQ29uZmlnLmV4Y2x1ZGVEZWYuYWRkKHZhbHVlKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBWYWx1ZXModGhpcy5rZWVwRGVmKSkge1xuICAgICAgaW5pdGlhbENvbmZpZy5rZWVwRGVmLmFkZCh2YWx1ZSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgbWFwVmFsdWVzKHRoaXMubW9ja0RlZikpIHtcbiAgICAgIGluaXRpYWxDb25maWcubW9ja0RlZi5hZGQodmFsdWUpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBtYXBFbnRyaWVzKHRoaXMucHJvdmlkZXJEZWYpKSB7XG4gICAgICBpbml0aWFsQ29uZmlnLnByb3ZpZGVyRGVmLnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBWYWx1ZXModGhpcy5yZXBsYWNlRGVmKSkge1xuICAgICAgaW5pdGlhbENvbmZpZy5yZXBsYWNlRGVmLmFkZCh2YWx1ZSk7XG4gICAgfVxuICAgIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuc2V0KCdidWlsZGVyOmNvbmZpZycsIGluaXRpYWxDb25maWcpO1xuXG4gICAgbmdNb2R1bGUgPSBzdXBlci5idWlsZCgpO1xuICAgIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuc2V0KCdidWlsZGVyOm1vZHVsZScsIG5nTW9kdWxlKTtcblxuICAgIC8vIGF2b2lkaW5nIGluZmx1ZW5jZXMgb24gY2FjaGUgd2hlbiB1c2VycyBleHRlbmQgdGhlIHRlc3RpbmcgbW9kdWxlLlxuICAgIHJldHVybiB7XG4gICAgICBkZWNsYXJhdGlvbnM6IFsuLi5uZ01vZHVsZS5kZWNsYXJhdGlvbnNdLFxuICAgICAgaW1wb3J0czogWy4uLm5nTW9kdWxlLmltcG9ydHNdLFxuICAgICAgcHJvdmlkZXJzOiBbLi4ubmdNb2R1bGUucHJvdmlkZXJzXSxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHRoZW48VFJlc3VsdDEgPSBJTW9ja0J1aWxkZXJSZXN1bHQsIFRSZXN1bHQyID0gbmV2ZXI+KFxuICAgIGZ1bGZpbGw/OiAodmFsdWU6IElNb2NrQnVpbGRlclJlc3VsdCkgPT4gUHJvbWlzZUxpa2U8VFJlc3VsdDE+LFxuICAgIHJlamVjdD86IChyZWFzb246IGFueSkgPT4gUHJvbWlzZUxpa2U8VFJlc3VsdDI+XG4gICk6IFByb21pc2VMaWtlPFRSZXN1bHQxIHwgVFJlc3VsdDI+IHtcbiAgICBpZiAoXG4gICAgICBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmhhcygnYnVsbGV0JykgJiZcbiAgICAgIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuaGFzKCdidWlsZGVyOm1vZHVsZScpICYmXG4gICAgICBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmhhcygnYnVpbGRlcjpjb25maWcnKSAmJlxuICAgICAgdGhpcy5lcXVhbHNUbyhuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmdldCgnYnVpbGRlcjpjb25maWcnKSlcbiAgICApIHtcbiAgICAgIHJldHVybiBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmdldChuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmdldCgnYnVpbGRlcjptb2R1bGUnKSkudGhlbihmdWxmaWxsLCByZWplY3QpO1xuICAgIH1cblxuICAgIC8vIHdlIG5lZWQgdG8gcmVzZXQgdGVzdGluZyBtb2R1bGUgaW4gY2FzZSBpZiB3ZSBhcmUgaW4gYnVsbGV0IG1vZGUgYnV0IGN1cnJlbnQgbW9kdWxlIGRvZXNuJ3QgbWF0Y2guXG4gICAgaWYgKG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuaGFzKCdidWxsZXQnKSAmJiBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmhhcygnYnVsbGV0OnJlc2V0JykpIHtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlXG4gICAgICBjb25zb2xlLndhcm4oJ25nTW9ja3MuZmFzdGVyIGhhcyB6ZXJvIGVmZmVjdCBkdWUgdG8gY2hhbmdlcyBpbiB0ZXN0aW5nIG1vZHVsZSBiZXR3ZWVuIHJ1bnMnKTtcbiAgICAgIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuZGVsZXRlKCdidWxsZXQnKTtcbiAgICAgIFRlc3RCZWQucmVzZXRUZXN0aW5nTW9kdWxlKCk7XG4gICAgICBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLnNldCgnYnVsbGV0JywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJvbWlzZSA9IHN1cGVyLnRoZW4oZnVsZmlsbCwgcmVqZWN0KTtcbiAgICBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLnNldChuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmdldCgnYnVpbGRlcjptb2R1bGUnKSwgcHJvbWlzZSk7XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItZnVuY3Rpb24tb3Zlci1tZXRob2RcbiAgcHJpdmF0ZSBlcXVhbFByb3ZpZGVycyhwcm90b3R5cGU6IGFueSwgc291cmNlOiBhbnkpOiBib29sZWFuIHtcbiAgICAvLyBhIGNhc2Ugb2YgbXVsdGkgdnMgbm9uLW11bHRpXG4gICAgaWYgKEFycmF5LmlzQXJyYXkocHJvdG90eXBlKSAhPT0gQXJyYXkuaXNBcnJheShzb3VyY2UpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHByb3RvdHlwZURlZnMgPSBmbGF0dGVuKHByb3RvdHlwZSk7XG4gICAgY29uc3QgdGhpc0RlZnMgPSBmbGF0dGVuKHNvdXJjZSk7XG4gICAgaWYgKHByb3RvdHlwZURlZnMubGVuZ3RoICE9PSB0aGlzRGVmcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHByb3RvdHlwZURlZnMubGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgICBjb25zdCBwcm90b3R5cGVEZWY6IGFueSA9IHByb3RvdHlwZURlZnNbaW5kZXhdO1xuICAgICAgY29uc3QgdGhpc0RlZjogYW55ID0gdGhpc0RlZnNbaW5kZXhdO1xuXG4gICAgICBpZiAocHJvdG90eXBlRGVmICYmIHRoaXNEZWYgJiYgcHJvdG90eXBlRGVmLm11bHRpICE9PSB0aGlzRGVmLm11bHRpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgcHJvdG90eXBlRGVmICYmXG4gICAgICAgIHRoaXNEZWYgJiZcbiAgICAgICAgcHJvdG90eXBlRGVmLnVzZVZhbHVlICYmXG4gICAgICAgIHRoaXNEZWYudXNlVmFsdWUgJiZcbiAgICAgICAgcHJvdG90eXBlRGVmLnVzZVZhbHVlID09PSB0aGlzRGVmLnVzZVZhbHVlXG4gICAgICApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIHByb3RvdHlwZURlZiAmJlxuICAgICAgICB0aGlzRGVmICYmXG4gICAgICAgIHByb3RvdHlwZURlZi51c2VDbGFzcyAmJlxuICAgICAgICB0aGlzRGVmLnVzZUNsYXNzICYmXG4gICAgICAgIHByb3RvdHlwZURlZi51c2VDbGFzcyA9PT0gdGhpc0RlZi51c2VDbGFzc1xuICAgICAgKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBwcm90b3R5cGVEZWYgJiZcbiAgICAgICAgdGhpc0RlZiAmJlxuICAgICAgICBwcm90b3R5cGVEZWYudXNlRmFjdG9yeSAmJlxuICAgICAgICB0aGlzRGVmLnVzZUZhY3RvcnkgJiZcbiAgICAgICAgcHJvdG90eXBlRGVmLnVzZUZhY3RvcnkgPT09IHRoaXNEZWYudXNlRmFjdG9yeVxuICAgICAgKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBwcm90b3R5cGVEZWYgJiZcbiAgICAgICAgdGhpc0RlZiAmJlxuICAgICAgICBwcm90b3R5cGVEZWYudXNlRXhpc3RpbmcgJiZcbiAgICAgICAgdGhpc0RlZi51c2VFeGlzdGluZyAmJlxuICAgICAgICBwcm90b3R5cGVEZWYudXNlRXhpc3RpbmcgPT09IHRoaXNEZWYudXNlRXhpc3RpbmdcbiAgICAgICkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChwcm90b3R5cGVEZWYgPT09IHRoaXNEZWYpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mdW5jdGlvbi1vdmVyLW1ldGhvZFxuICBwcml2YXRlIGVxdWFsUmVuZGVyKHByb3RvdHlwZTogYW55LCBzb3VyY2U6IGFueSk6IGJvb2xlYW4ge1xuICAgIGlmIChwcm90b3R5cGUgPT09IHNvdXJjZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICgodHlwZW9mIHByb3RvdHlwZSA9PT0gJ2Jvb2xlYW4nIHx8IHR5cGVvZiBzb3VyY2UgPT09ICdib29sZWFuJykgJiYgcHJvdG90eXBlICE9PSBzb3VyY2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHByb3RvdHlwZS4kaW1wbGljaXQgIT09IHNvdXJjZS4kaW1wbGljaXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmVxdWFsVmFyaWFibGVzKHByb3RvdHlwZS52YXJpYWJsZXMsIHNvdXJjZS52YXJpYWJsZXMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwcml2YXRlIGVxdWFsc1RvKHByb3RvdHlwZTogUmVjb3JkPGFueSwgYW55Pik6IGJvb2xlYW4ge1xuICAgIGlmICghcHJvdG90eXBlLmJlZm9yZUNDIHx8IHByb3RvdHlwZS5iZWZvcmVDQy5zaXplICE9PSB0aGlzLmJlZm9yZUNDLnNpemUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBWYWx1ZXModGhpcy5iZWZvcmVDQykpIHtcbiAgICAgIGlmICghcHJvdG90eXBlLmJlZm9yZUNDLmhhcyh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcHJvdG90eXBlLmtlZXBEZWYgfHwgcHJvdG90eXBlLmtlZXBEZWYuc2l6ZSAhPT0gdGhpcy5rZWVwRGVmLnNpemUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBWYWx1ZXModGhpcy5rZWVwRGVmKSkge1xuICAgICAgaWYgKCFwcm90b3R5cGUua2VlcERlZi5oYXModmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXByb3RvdHlwZS5yZXBsYWNlRGVmIHx8IHByb3RvdHlwZS5yZXBsYWNlRGVmLnNpemUgIT09IHRoaXMucmVwbGFjZURlZi5zaXplKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgbWFwVmFsdWVzKHRoaXMucmVwbGFjZURlZikpIHtcbiAgICAgIGlmICghcHJvdG90eXBlLnJlcGxhY2VEZWYuaGFzKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFwcm90b3R5cGUuZXhjbHVkZURlZiB8fCBwcm90b3R5cGUuZXhjbHVkZURlZi5zaXplICE9PSB0aGlzLmV4Y2x1ZGVEZWYuc2l6ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIG1hcFZhbHVlcyh0aGlzLmV4Y2x1ZGVEZWYpKSB7XG4gICAgICBpZiAoIXByb3RvdHlwZS5leGNsdWRlRGVmLmhhcyh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcHJvdG90eXBlLm1vY2tEZWYgfHwgcHJvdG90eXBlLm1vY2tEZWYuc2l6ZSAhPT0gdGhpcy5tb2NrRGVmLnNpemUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBWYWx1ZXModGhpcy5tb2NrRGVmKSkge1xuICAgICAgaWYgKCFwcm90b3R5cGUubW9ja0RlZi5oYXModmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXByb3RvdHlwZS5wcm92aWRlckRlZiB8fCBwcm90b3R5cGUucHJvdmlkZXJEZWYuc2l6ZSAhPT0gdGhpcy5wcm92aWRlckRlZi5zaXplKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgbWFwS2V5cyh0aGlzLnByb3ZpZGVyRGVmKSkge1xuICAgICAgaWYgKCFwcm90b3R5cGUucHJvdmlkZXJEZWYuaGFzKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuZXF1YWxQcm92aWRlcnMocHJvdG90eXBlLnByb3ZpZGVyRGVmLmdldCh2YWx1ZSksIHRoaXMucHJvdmlkZXJEZWYuZ2V0KHZhbHVlKSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcHJvdG90eXBlLmRlZlByb3ZpZGVycyB8fCBwcm90b3R5cGUuZGVmUHJvdmlkZXJzLnNpemUgIT09IHRoaXMuZGVmUHJvdmlkZXJzLnNpemUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBLZXlzKHRoaXMuZGVmUHJvdmlkZXJzKSkge1xuICAgICAgaWYgKCFwcm90b3R5cGUuZGVmUHJvdmlkZXJzLmhhcyh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmVxdWFsUHJvdmlkZXJzKHByb3RvdHlwZS5kZWZQcm92aWRlcnMuZ2V0KHZhbHVlKSwgdGhpcy5kZWZQcm92aWRlcnMuZ2V0KHZhbHVlKSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcHJvdG90eXBlLmRlZlZhbHVlIHx8IHByb3RvdHlwZS5kZWZWYWx1ZS5zaXplICE9PSB0aGlzLmRlZlZhbHVlLnNpemUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBtYXBLZXlzKHRoaXMuZGVmVmFsdWUpKSB7XG4gICAgICBpZiAoIXByb3RvdHlwZS5kZWZWYWx1ZS5oYXModmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChwcm90b3R5cGUuZGVmVmFsdWUuZ2V0KHZhbHVlKSAhPT0gdGhpcy5kZWZWYWx1ZS5nZXQodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXByb3RvdHlwZS5jb25maWdEZWYgfHwgcHJvdG90eXBlLmNvbmZpZ0RlZi5zaXplICE9PSB0aGlzLmNvbmZpZ0RlZi5zaXplKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgbWFwS2V5cyh0aGlzLmNvbmZpZ0RlZikpIHtcbiAgICAgIGlmICghcHJvdG90eXBlLmNvbmZpZ0RlZi5oYXModmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbmZpZ1Byb3RvdHlwZSA9IHByb3RvdHlwZS5jb25maWdEZWYuZ2V0KHZhbHVlKTtcbiAgICAgIGNvbnN0IGNvbmZpZ1RoaXMgPSB0aGlzLmNvbmZpZ0RlZi5nZXQodmFsdWUpO1xuICAgICAgaWYgKGNvbmZpZ1Byb3RvdHlwZSA9PT0gY29uZmlnVGhpcykge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChjb25maWdQcm90b3R5cGUuZGVwZW5kZW5jeSAhPT0gY29uZmlnVGhpcy5kZXBlbmRlbmN5KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChjb25maWdQcm90b3R5cGUuZXhwb3J0ICE9PSBjb25maWdUaGlzLmV4cG9ydCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoY29uZmlnUHJvdG90eXBlLmV4cG9ydEFsbCAhPT0gY29uZmlnVGhpcy5leHBvcnRBbGwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmVxdWFsUmVuZGVyKGNvbmZpZ1Byb3RvdHlwZS5yZW5kZXIsIGNvbmZpZ1RoaXMucmVuZGVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGNvbmZpZ1Byb3RvdHlwZS5yZW5kZXIgIT09ICdvYmplY3QnIHx8IHR5cGVvZiBjb25maWdUaGlzLnJlbmRlciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoT2JqZWN0LmtleXMoY29uZmlnUHJvdG90eXBlLnJlbmRlcikubGVuZ3RoICE9PSBPYmplY3Qua2V5cyhjb25maWdUaGlzLnJlbmRlcikubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGNvbmZpZ1Byb3RvdHlwZS5yZW5kZXIpKSB7XG4gICAgICAgIGlmICghdGhpcy5lcXVhbFJlbmRlcihjb25maWdQcm90b3R5cGUucmVuZGVyW2tleV0sIGNvbmZpZ1RoaXMucmVuZGVyW2tleV0pKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWZ1bmN0aW9uLW92ZXItbWV0aG9kXG4gIHByaXZhdGUgZXF1YWxWYXJpYWJsZXMocHJvdG90eXBlOiBhbnksIHNvdXJjZTogYW55KTogYm9vbGVhbiB7XG4gICAgaWYgKHByb3RvdHlwZSA9PT0gc291cmNlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHByb3RvdHlwZSAmJiAhc291cmNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICghcHJvdG90eXBlICYmIHNvdXJjZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBwcm90b3R5cGVLZXlzID0gT2JqZWN0LmtleXMocHJvdG90eXBlKTtcbiAgICBjb25zdCBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTtcbiAgICBpZiAocHJvdG90eXBlS2V5cy5sZW5ndGggIT09IHNvdXJjZUtleXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAoY29uc3Qga2V5IG9mIHByb3RvdHlwZUtleXMpIHtcbiAgICAgIGlmIChwcm90b3R5cGVba2V5XSAhPT0gc291cmNlW2tleV0pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuIl19