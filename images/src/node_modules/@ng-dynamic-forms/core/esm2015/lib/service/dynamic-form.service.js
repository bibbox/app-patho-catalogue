import { Injectable } from "@angular/core";
import { FormArray, FormControl, FormGroup } from "@angular/forms";
import { DynamicFormArrayModel, DYNAMIC_FORM_CONTROL_TYPE_ARRAY, DynamicFormArrayGroupModel } from "../model/form-array/dynamic-form-array.model";
import { DYNAMIC_FORM_CONTROL_TYPE_GROUP, DynamicFormGroupModel } from "../model/form-group/dynamic-form-group.model";
import { DYNAMIC_FORM_CONTROL_TYPE_CHECKBOX_GROUP, DynamicCheckboxGroupModel } from "../model/checkbox/dynamic-checkbox-group.model";
import { DYNAMIC_FORM_CONTROL_TYPE_CHECKBOX, DynamicCheckboxModel } from "../model/checkbox/dynamic-checkbox.model";
import { DYNAMIC_FORM_CONTROL_TYPE_COLORPICKER, DynamicColorPickerModel } from "../model/colorpicker/dynamic-colorpicker.model";
import { DYNAMIC_FORM_CONTROL_TYPE_DATEPICKER, DynamicDatePickerModel } from "../model/datepicker/dynamic-datepicker.model";
import { DYNAMIC_FORM_CONTROL_TYPE_EDITOR, DynamicEditorModel } from "../model/editor/dynamic-editor.model";
import { DYNAMIC_FORM_CONTROL_TYPE_FILE_UPLOAD, DynamicFileUploadModel } from "../model/file-upload/dynamic-file-upload.model";
import { DYNAMIC_FORM_CONTROL_TYPE_INPUT, DynamicInputModel } from "../model/input/dynamic-input.model";
import { DYNAMIC_FORM_CONTROL_TYPE_RADIO_GROUP, DynamicRadioGroupModel } from "../model/radio/dynamic-radio-group.model";
import { DYNAMIC_FORM_CONTROL_TYPE_RATING, DynamicRatingModel } from "../model/rating/dynamic-rating.model";
import { DYNAMIC_FORM_CONTROL_TYPE_SELECT, DynamicSelectModel } from "../model/select/dynamic-select.model";
import { DYNAMIC_FORM_CONTROL_TYPE_SLIDER, DynamicSliderModel } from "../model/slider/dynamic-slider.model";
import { DYNAMIC_FORM_CONTROL_TYPE_SWITCH, DynamicSwitchModel } from "../model/switch/dynamic-switch.model";
import { DYNAMIC_FORM_CONTROL_TYPE_TEXTAREA, DynamicTextAreaModel } from "../model/textarea/dynamic-textarea.model";
import { DYNAMIC_FORM_CONTROL_TYPE_TIMEPICKER, DynamicTimePickerModel } from "../model/timepicker/dynamic-timepicker.model";
import { DynamicFormValidationService } from "./dynamic-form-validation.service";
import { DynamicFormHook } from "../model/misc/dynamic-form-control-validation.model";
import { maskFromString, parseReviver } from "../utils/json.utils";
import { isString } from "../utils/core.utils";
import { DynamicFormComponent } from "../component/dynamic-form.component";
import { DynamicFormComponentService } from "./dynamic-form-component.service";
import * as i0 from "@angular/core";
import * as i1 from "./dynamic-form-component.service";
import * as i2 from "./dynamic-form-validation.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './dynamic-form-component.service';
import * as ɵngcc2 from './dynamic-form-validation.service';
export class DynamicFormService {
    constructor(componentService, validationService) {
        this.componentService = componentService;
        this.validationService = validationService;
    }
    createAbstractControlOptions(validatorsConfig = null, asyncValidatorsConfig = null, updateOn = null) {
        return {
            asyncValidators: asyncValidatorsConfig !== null ? this.validationService.getAsyncValidators(asyncValidatorsConfig) : null,
            validators: validatorsConfig !== null ? this.validationService.getValidators(validatorsConfig) : null,
            updateOn: updateOn !== null && this.validationService.isFormHook(updateOn) ? updateOn : DynamicFormHook.Change
        };
    }
    createFormArray(formArrayModel) {
        const controls = [];
        const options = this.createAbstractControlOptions(formArrayModel.validators, formArrayModel.asyncValidators, formArrayModel.updateOn);
        for (let index = 0; index < formArrayModel.size; index++) {
            const groupModel = formArrayModel.get(index);
            const groupOptions = this.createAbstractControlOptions(formArrayModel.groupValidators, formArrayModel.groupAsyncValidators, formArrayModel.updateOn);
            controls.push(this.createFormGroup(groupModel.group, groupOptions, groupModel));
        }
        return new FormArray(controls, options);
    }
    createFormGroup(formModel, options = null, parent = null) {
        const controls = {};
        formModel.forEach(model => {
            model.parent = parent;
            switch (model.type) {
                case DYNAMIC_FORM_CONTROL_TYPE_ARRAY:
                    controls[model.id] = this.createFormArray(model);
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_GROUP:
                case DYNAMIC_FORM_CONTROL_TYPE_CHECKBOX_GROUP:
                    const groupModel = model;
                    const groupOptions = this.createAbstractControlOptions(groupModel.validators, groupModel.asyncValidators, groupModel.updateOn);
                    controls[model.id] = this.createFormGroup(groupModel.group, groupOptions, groupModel);
                    break;
                default:
                    const controlModel = model;
                    const controlState = { value: controlModel.value, disabled: controlModel.disabled };
                    const controlOptions = this.createAbstractControlOptions(controlModel.validators, controlModel.asyncValidators, controlModel.updateOn);
                    controls[model.id] = new FormControl(controlState, controlOptions);
            }
        });
        return new FormGroup(controls, options);
    }
    getPathSegment(model) {
        return model instanceof DynamicFormArrayGroupModel ? model.index.toString() : model.id;
    }
    getPath(model, join = false) {
        const path = [this.getPathSegment(model)];
        let parent = model.parent;
        while (parent) {
            path.unshift(this.getPathSegment(parent));
            parent = parent.parent;
        }
        return join ? path.join(".") : path;
    }
    addFormGroupControl(formGroup, formModel, ...models) {
        if (formModel instanceof DynamicFormGroupModel) {
            this.insertFormGroupControl(formModel.size(), formGroup, formModel, ...models);
        }
        else {
            const model = formModel;
            this.insertFormGroupControl(model.length, formGroup, model, ...models);
        }
    }
    moveFormGroupControl(index, step, formModel) {
        if (formModel instanceof DynamicFormGroupModel) {
            formModel.move(index, step);
        }
        else {
            const model = formModel;
            model.splice(index + step, 0, ...model.splice(index, 1));
        }
    }
    insertFormGroupControl(index, formGroup, formModel, ...models) {
        const parent = formModel instanceof DynamicFormGroupModel ? formModel : null;
        const controls = this.createFormGroup(models, null, parent).controls;
        Object.keys(controls).forEach((controlName, idx) => {
            const controlModel = models[idx];
            if (formModel instanceof DynamicFormGroupModel) {
                formModel.insert(index, controlModel);
            }
            else {
                formModel.splice(index, 0, controlModel);
            }
            formGroup.addControl(controlName, controls[controlName]);
        });
    }
    removeFormGroupControl(index, formGroup, formModel) {
        if (formModel instanceof DynamicFormGroupModel) {
            formGroup.removeControl(formModel.get(index).id);
            formModel.remove(index);
        }
        else {
            formGroup.removeControl(formModel[index].id);
            formModel.splice(index, 1);
        }
    }
    addFormArrayGroup(formArray, formArrayModel) {
        const groupModel = formArrayModel.addGroup();
        formArray.push(this.createFormGroup(groupModel.group, null, groupModel));
    }
    insertFormArrayGroup(index, formArray, formArrayModel) {
        const groupModel = formArrayModel.insertGroup(index);
        formArray.insert(index, this.createFormGroup(groupModel.group, null, groupModel));
    }
    moveFormArrayGroup(index, step, formArray, formArrayModel) {
        const newIndex = index + step;
        const moveUp = step >= 0;
        if ((index >= 0 && index < formArrayModel.size) && (newIndex >= 0 && newIndex < formArrayModel.size)) {
            const movingGroups = [];
            for (let i = moveUp ? index : newIndex; i <= (moveUp ? newIndex : index); i++) {
                movingGroups.push(formArray.at(i));
            }
            movingGroups.forEach((formControl, idx) => {
                let position;
                if (moveUp) {
                    position = idx === 0 ? newIndex : index + idx - 1;
                }
                else {
                    position = idx === movingGroups.length - 1 ? newIndex : newIndex + idx + 1;
                }
                formArray.setControl(position, formControl);
            });
            formArrayModel.moveGroup(index, step);
        }
        else {
            throw new Error(`form array group cannot be moved due to index or new index being out of bounds`);
        }
    }
    removeFormArrayGroup(index, formArray, formArrayModel) {
        formArray.removeAt(index);
        formArrayModel.removeGroup(index);
    }
    clearFormArray(formArray, formArrayModel) {
        formArray.clear();
        formArrayModel.clear();
    }
    findById(id, formModel) {
        let result = null;
        const findByIdFn = (modelId, groupModel) => {
            for (const controlModel of groupModel) {
                if (controlModel.id === modelId) {
                    result = controlModel;
                    break;
                }
                if (controlModel instanceof DynamicFormGroupModel) {
                    findByIdFn(modelId, controlModel.group);
                }
            }
        };
        findByIdFn(id, formModel);
        return result;
    }
    findModelById(id, formModel) {
        return this.findById(id, formModel);
    }
    findControlByModel(model, group) {
        return group.root.get(this.getPath(model, true));
    }
    detectChanges(formComponent) {
        if (formComponent instanceof DynamicFormComponent) {
            formComponent.markForCheck();
            formComponent.detectChanges();
        }
        else {
            for (const form of this.componentService.getForms()) {
                form.markForCheck();
                form.detectChanges();
            }
        }
    }
    fromJSON(json) {
        const formModelJSON = isString(json) ? JSON.parse(json, parseReviver) : json;
        const formModel = [];
        formModelJSON.forEach((model) => {
            var _a;
            const layout = (_a = model.layout) !== null && _a !== void 0 ? _a : null;
            switch (model.type) {
                case DYNAMIC_FORM_CONTROL_TYPE_ARRAY:
                    const formArrayModel = model;
                    if (Array.isArray(formArrayModel.groups)) {
                        formArrayModel.groups.forEach((groupModel) => {
                            groupModel.group = this.fromJSON(groupModel.group);
                        });
                    }
                    formArrayModel.groupFactory = () => {
                        return this.fromJSON(formArrayModel.groupPrototype);
                    };
                    formModel.push(new DynamicFormArrayModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_CHECKBOX:
                    formModel.push(new DynamicCheckboxModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_CHECKBOX_GROUP:
                    model.group = this.fromJSON(model.group);
                    formModel.push(new DynamicCheckboxGroupModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_COLORPICKER:
                    formModel.push(new DynamicColorPickerModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_DATEPICKER:
                    formModel.push(new DynamicDatePickerModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_EDITOR:
                    formModel.push(new DynamicEditorModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_FILE_UPLOAD:
                    model.value = null;
                    formModel.push(new DynamicFileUploadModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_GROUP:
                    model.group = this.fromJSON(model.group);
                    formModel.push(new DynamicFormGroupModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_INPUT:
                    const inputModel = model;
                    if (inputModel.mask !== null) {
                        if (!(inputModel.mask instanceof Function)) {
                            inputModel.mask = maskFromString(inputModel.mask);
                        }
                    }
                    formModel.push(new DynamicInputModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_RADIO_GROUP:
                    formModel.push(new DynamicRadioGroupModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_RATING:
                    formModel.push(new DynamicRatingModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_SELECT:
                    formModel.push(new DynamicSelectModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_SLIDER:
                    formModel.push(new DynamicSliderModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_SWITCH:
                    formModel.push(new DynamicSwitchModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_TEXTAREA:
                    formModel.push(new DynamicTextAreaModel(model, layout));
                    break;
                case DYNAMIC_FORM_CONTROL_TYPE_TIMEPICKER:
                    formModel.push(new DynamicTimePickerModel(model, layout));
                    break;
                default:
                    throw new Error(`unknown form control model type defined on JSON object with id "${model.id}"`);
            }
        });
        return formModel;
    }
}
DynamicFormService.ɵfac = function DynamicFormService_Factory(t) { return new (t || DynamicFormService)(ɵngcc0.ɵɵinject(ɵngcc1.DynamicFormComponentService), ɵngcc0.ɵɵinject(ɵngcc2.DynamicFormValidationService)); };
DynamicFormService.ɵprov = i0.ɵɵdefineInjectable({ factory: function DynamicFormService_Factory() { return new DynamicFormService(i0.ɵɵinject(i1.DynamicFormComponentService), i0.ɵɵinject(i2.DynamicFormValidationService)); }, token: DynamicFormService, providedIn: "root" });
DynamicFormService.ctorParameters = () => [
    { type: DynamicFormComponentService },
    { type: DynamicFormValidationService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DynamicFormService, [{
        type: Injectable,
        args: [{
                providedIn: "root"
            }]
    }], function () { return [{ type: ɵngcc1.DynamicFormComponentService }, { type: ɵngcc2.DynamicFormValidationService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWR5bmFtaWMtZm9ybXMvY29yZS9zcmMvbGliL3NlcnZpY2UvZHluYW1pYy1mb3JtLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQW1CLFNBQVMsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJcEYsT0FBTyxFQUNILHFCQUFxQixFQUNyQiwrQkFBK0IsRUFDL0IsMEJBQTBCLEVBQzdCLE1BQU0sOENBQThDLENBQUM7QUFDdEQsT0FBTyxFQUFFLCtCQUErQixFQUFFLHFCQUFxQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDdEgsT0FBTyxFQUNILHdDQUF3QyxFQUN4Qyx5QkFBeUIsRUFDNUIsTUFBTSxnREFBZ0QsQ0FBQztBQUN4RCxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNwSCxPQUFPLEVBQ0gscUNBQXFDLEVBQ3JDLHVCQUF1QixFQUMxQixNQUFNLGdEQUFnRCxDQUFDO0FBQ3hELE9BQU8sRUFDSCxvQ0FBb0MsRUFDcEMsc0JBQXNCLEVBQ3pCLE1BQU0sOENBQThDLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDNUcsT0FBTyxFQUNILHFDQUFxQyxFQUNyQyxzQkFBc0IsRUFDekIsTUFBTSxnREFBZ0QsQ0FBQztBQUN4RCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUN4RyxPQUFPLEVBQ0gscUNBQXFDLEVBQ3JDLHNCQUFzQixFQUN6QixNQUFNLDBDQUEwQyxDQUFDO0FBQ2xELE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxr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QUFTLENBQUM7QUFDekIsSUFBSSxDQUFDO0FBQ0w7c05BQUM7QUFDRCxrUkFqWEs7QUFBQztFQUhMLFVBQVUsU0FBQyxrQkFDUix2Q0FJVyxZQVBOLDJCQUEyQjtNQUd0QixFQUFFLE1BQU0sY0FDckIsNUJBSnVDLFlBUC9CLDRCQUE0QjtBQUFHOzs7Ozs7MklBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBGb3JtQXJyYXksIEZvcm1Db250cm9sLCBGb3JtR3JvdXAgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbE9wdGlvbnMgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL2R5bmFtaWMtZm9ybS1jb250cm9sLm1vZGVsXCI7XG5pbXBvcnQgeyBEeW5hbWljRm9ybVZhbHVlQ29udHJvbE1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL2R5bmFtaWMtZm9ybS12YWx1ZS1jb250cm9sLm1vZGVsXCI7XG5pbXBvcnQge1xuICAgIER5bmFtaWNGb3JtQXJyYXlNb2RlbCxcbiAgICBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0FSUkFZLFxuICAgIER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsXG59IGZyb20gXCIuLi9tb2RlbC9mb3JtLWFycmF5L2R5bmFtaWMtZm9ybS1hcnJheS5tb2RlbFwiO1xuaW1wb3J0IHsgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9HUk9VUCwgRHluYW1pY0Zvcm1Hcm91cE1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL2Zvcm0tZ3JvdXAvZHluYW1pYy1mb3JtLWdyb3VwLm1vZGVsXCI7XG5pbXBvcnQge1xuICAgIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfQ0hFQ0tCT1hfR1JPVVAsXG4gICAgRHluYW1pY0NoZWNrYm94R3JvdXBNb2RlbFxufSBmcm9tIFwiLi4vbW9kZWwvY2hlY2tib3gvZHluYW1pYy1jaGVja2JveC1ncm91cC5tb2RlbFwiO1xuaW1wb3J0IHsgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9DSEVDS0JPWCwgRHluYW1pY0NoZWNrYm94TW9kZWwgfSBmcm9tIFwiLi4vbW9kZWwvY2hlY2tib3gvZHluYW1pYy1jaGVja2JveC5tb2RlbFwiO1xuaW1wb3J0IHtcbiAgICBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0NPTE9SUElDS0VSLFxuICAgIER5bmFtaWNDb2xvclBpY2tlck1vZGVsXG59IGZyb20gXCIuLi9tb2RlbC9jb2xvcnBpY2tlci9keW5hbWljLWNvbG9ycGlja2VyLm1vZGVsXCI7XG5pbXBvcnQge1xuICAgIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfREFURVBJQ0tFUixcbiAgICBEeW5hbWljRGF0ZVBpY2tlck1vZGVsXG59IGZyb20gXCIuLi9tb2RlbC9kYXRlcGlja2VyL2R5bmFtaWMtZGF0ZXBpY2tlci5tb2RlbFwiO1xuaW1wb3J0IHsgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9FRElUT1IsIER5bmFtaWNFZGl0b3JNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9lZGl0b3IvZHluYW1pYy1lZGl0b3IubW9kZWxcIjtcbmltcG9ydCB7XG4gICAgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9GSUxFX1VQTE9BRCxcbiAgICBEeW5hbWljRmlsZVVwbG9hZE1vZGVsXG59IGZyb20gXCIuLi9tb2RlbC9maWxlLXVwbG9hZC9keW5hbWljLWZpbGUtdXBsb2FkLm1vZGVsXCI7XG5pbXBvcnQgeyBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0lOUFVULCBEeW5hbWljSW5wdXRNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9pbnB1dC9keW5hbWljLWlucHV0Lm1vZGVsXCI7XG5pbXBvcnQge1xuICAgIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfUkFESU9fR1JPVVAsXG4gICAgRHluYW1pY1JhZGlvR3JvdXBNb2RlbFxufSBmcm9tIFwiLi4vbW9kZWwvcmFkaW8vZHluYW1pYy1yYWRpby1ncm91cC5tb2RlbFwiO1xuaW1wb3J0IHsgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9SQVRJTkcsIER5bmFtaWNSYXRpbmdNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9yYXRpbmcvZHluYW1pYy1yYXRpbmcubW9kZWxcIjtcbmltcG9ydCB7IERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfU0VMRUNULCBEeW5hbWljU2VsZWN0TW9kZWwgfSBmcm9tIFwiLi4vbW9kZWwvc2VsZWN0L2R5bmFtaWMtc2VsZWN0Lm1vZGVsXCI7XG5pbXBvcnQgeyBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1NMSURFUiwgRHluYW1pY1NsaWRlck1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL3NsaWRlci9keW5hbWljLXNsaWRlci5tb2RlbFwiO1xuaW1wb3J0IHsgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9TV0lUQ0gsIER5bmFtaWNTd2l0Y2hNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9zd2l0Y2gvZHluYW1pYy1zd2l0Y2gubW9kZWxcIjtcbmltcG9ydCB7IERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfVEVYVEFSRUEsIER5bmFtaWNUZXh0QXJlYU1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL3RleHRhcmVhL2R5bmFtaWMtdGV4dGFyZWEubW9kZWxcIjtcbmltcG9ydCB7XG4gICAgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9USU1FUElDS0VSLFxuICAgIER5bmFtaWNUaW1lUGlja2VyTW9kZWxcbn0gZnJvbSBcIi4uL21vZGVsL3RpbWVwaWNrZXIvZHluYW1pYy10aW1lcGlja2VyLm1vZGVsXCI7XG5pbXBvcnQgeyBEeW5hbWljRm9ybVZhbGlkYXRpb25TZXJ2aWNlIH0gZnJvbSBcIi4vZHluYW1pYy1mb3JtLXZhbGlkYXRpb24uc2VydmljZVwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Nb2RlbCwgRHluYW1pY1VuaW9uRm9ybU1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL2R5bmFtaWMtZm9ybS5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY1BhdGhhYmxlIH0gZnJvbSBcIi4uL21vZGVsL21pc2MvZHluYW1pYy1mb3JtLWNvbnRyb2wtcGF0aC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Ib29rLCBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZyB9IGZyb20gXCIuLi9tb2RlbC9taXNjL2R5bmFtaWMtZm9ybS1jb250cm9sLXZhbGlkYXRpb24ubW9kZWxcIjtcbmltcG9ydCB7IG1hc2tGcm9tU3RyaW5nLCBwYXJzZVJldml2ZXIgfSBmcm9tIFwiLi4vdXRpbHMvanNvbi51dGlsc1wiO1xuaW1wb3J0IHsgaXNTdHJpbmcgfSBmcm9tIFwiLi4vdXRpbHMvY29yZS51dGlsc1wiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Db21wb25lbnQgfSBmcm9tIFwiLi4vY29tcG9uZW50L2R5bmFtaWMtZm9ybS5jb21wb25lbnRcIjtcbmltcG9ydCB7IER5bmFtaWNGb3JtQ29tcG9uZW50U2VydmljZSB9IGZyb20gXCIuL2R5bmFtaWMtZm9ybS1jb21wb25lbnQuc2VydmljZVwiO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogXCJyb290XCJcbn0pXG5leHBvcnQgY2xhc3MgRHluYW1pY0Zvcm1TZXJ2aWNlIHtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29tcG9uZW50U2VydmljZTogRHluYW1pY0Zvcm1Db21wb25lbnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdmFsaWRhdGlvblNlcnZpY2U6IER5bmFtaWNGb3JtVmFsaWRhdGlvblNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZUFic3RyYWN0Q29udHJvbE9wdGlvbnModmFsaWRhdG9yc0NvbmZpZzogRHluYW1pY1ZhbGlkYXRvcnNDb25maWcgfCBudWxsID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmNWYWxpZGF0b3JzQ29uZmlnOiBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZyB8IG51bGwgPSBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVPbjogRHluYW1pY0Zvcm1Ib29rIHwgbnVsbCA9IG51bGwpOiBBYnN0cmFjdENvbnRyb2xPcHRpb25zIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXN5bmNWYWxpZGF0b3JzOiBhc3luY1ZhbGlkYXRvcnNDb25maWcgIT09IG51bGwgPyB0aGlzLnZhbGlkYXRpb25TZXJ2aWNlLmdldEFzeW5jVmFsaWRhdG9ycyhhc3luY1ZhbGlkYXRvcnNDb25maWcpIDogbnVsbCxcbiAgICAgICAgICAgIHZhbGlkYXRvcnM6IHZhbGlkYXRvcnNDb25maWcgIT09IG51bGwgPyB0aGlzLnZhbGlkYXRpb25TZXJ2aWNlLmdldFZhbGlkYXRvcnModmFsaWRhdG9yc0NvbmZpZykgOiBudWxsLFxuICAgICAgICAgICAgdXBkYXRlT246IHVwZGF0ZU9uICE9PSBudWxsICYmIHRoaXMudmFsaWRhdGlvblNlcnZpY2UuaXNGb3JtSG9vayh1cGRhdGVPbikgPyB1cGRhdGVPbiA6IER5bmFtaWNGb3JtSG9vay5DaGFuZ2VcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjcmVhdGVGb3JtQXJyYXkoZm9ybUFycmF5TW9kZWw6IER5bmFtaWNGb3JtQXJyYXlNb2RlbCk6IEZvcm1BcnJheSB7XG5cbiAgICAgICAgY29uc3QgY29udHJvbHM6IEFic3RyYWN0Q29udHJvbFtdID0gW107XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmNyZWF0ZUFic3RyYWN0Q29udHJvbE9wdGlvbnMoZm9ybUFycmF5TW9kZWwudmFsaWRhdG9ycywgZm9ybUFycmF5TW9kZWwuYXN5bmNWYWxpZGF0b3JzLFxuICAgICAgICAgICAgZm9ybUFycmF5TW9kZWwudXBkYXRlT24pO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBmb3JtQXJyYXlNb2RlbC5zaXplOyBpbmRleCsrKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGdyb3VwTW9kZWwgPSBmb3JtQXJyYXlNb2RlbC5nZXQoaW5kZXgpO1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBPcHRpb25zID0gdGhpcy5jcmVhdGVBYnN0cmFjdENvbnRyb2xPcHRpb25zKGZvcm1BcnJheU1vZGVsLmdyb3VwVmFsaWRhdG9ycyxcbiAgICAgICAgICAgICAgICBmb3JtQXJyYXlNb2RlbC5ncm91cEFzeW5jVmFsaWRhdG9ycywgZm9ybUFycmF5TW9kZWwudXBkYXRlT24pO1xuXG4gICAgICAgICAgICBjb250cm9scy5wdXNoKHRoaXMuY3JlYXRlRm9ybUdyb3VwKGdyb3VwTW9kZWwuZ3JvdXAsIGdyb3VwT3B0aW9ucywgZ3JvdXBNb2RlbCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBGb3JtQXJyYXkoY29udHJvbHMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGNyZWF0ZUZvcm1Hcm91cChmb3JtTW9kZWw6IER5bmFtaWNGb3JtTW9kZWwsIG9wdGlvbnM6IEFic3RyYWN0Q29udHJvbE9wdGlvbnMgfCBudWxsID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBEeW5hbWljUGF0aGFibGUgfCBudWxsID0gbnVsbCk6IEZvcm1Hcm91cCB7XG5cbiAgICAgICAgY29uc3QgY29udHJvbHM6IHsgW2NvbnRyb2xJZDogc3RyaW5nXTogQWJzdHJhY3RDb250cm9sOyB9ID0ge307XG5cbiAgICAgICAgZm9ybU1vZGVsLmZvckVhY2gobW9kZWwgPT4ge1xuXG4gICAgICAgICAgICBtb2RlbC5wYXJlbnQgPSBwYXJlbnQ7XG5cbiAgICAgICAgICAgIHN3aXRjaCAobW9kZWwudHlwZSkge1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0FSUkFZOlxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW21vZGVsLmlkXSA9IHRoaXMuY3JlYXRlRm9ybUFycmF5KG1vZGVsIGFzIER5bmFtaWNGb3JtQXJyYXlNb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0dST1VQOlxuICAgICAgICAgICAgICAgIGNhc2UgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9DSEVDS0JPWF9HUk9VUDpcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBncm91cE1vZGVsID0gbW9kZWwgYXMgRHluYW1pY0Zvcm1Hcm91cE1vZGVsO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBncm91cE9wdGlvbnMgPSB0aGlzLmNyZWF0ZUFic3RyYWN0Q29udHJvbE9wdGlvbnMoZ3JvdXBNb2RlbC52YWxpZGF0b3JzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBNb2RlbC5hc3luY1ZhbGlkYXRvcnMsIGdyb3VwTW9kZWwudXBkYXRlT24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW21vZGVsLmlkXSA9IHRoaXMuY3JlYXRlRm9ybUdyb3VwKGdyb3VwTW9kZWwuZ3JvdXAsIGdyb3VwT3B0aW9ucywgZ3JvdXBNb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sTW9kZWwgPSBtb2RlbCBhcyBEeW5hbWljRm9ybVZhbHVlQ29udHJvbE1vZGVsPGFueT47XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xTdGF0ZSA9IHt2YWx1ZTogY29udHJvbE1vZGVsLnZhbHVlLCBkaXNhYmxlZDogY29udHJvbE1vZGVsLmRpc2FibGVkfTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udHJvbE9wdGlvbnMgPSB0aGlzLmNyZWF0ZUFic3RyYWN0Q29udHJvbE9wdGlvbnMoY29udHJvbE1vZGVsLnZhbGlkYXRvcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sTW9kZWwuYXN5bmNWYWxpZGF0b3JzLCBjb250cm9sTW9kZWwudXBkYXRlT24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzW21vZGVsLmlkXSA9IG5ldyBGb3JtQ29udHJvbChjb250cm9sU3RhdGUsIGNvbnRyb2xPcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBGb3JtR3JvdXAoY29udHJvbHMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGdldFBhdGhTZWdtZW50KG1vZGVsOiBEeW5hbWljUGF0aGFibGUpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbW9kZWwgaW5zdGFuY2VvZiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCA/IG1vZGVsLmluZGV4LnRvU3RyaW5nKCkgOiAobW9kZWwgYXMgRHluYW1pY0Zvcm1Db250cm9sTW9kZWwpLmlkO1xuICAgIH1cblxuICAgIGdldFBhdGgobW9kZWw6IER5bmFtaWNQYXRoYWJsZSwgam9pbjogYm9vbGVhbiA9IGZhbHNlKTogc3RyaW5nW10gfCBzdHJpbmcge1xuXG4gICAgICAgIGNvbnN0IHBhdGggPSBbdGhpcy5nZXRQYXRoU2VnbWVudChtb2RlbCldO1xuICAgICAgICBsZXQgcGFyZW50ID0gbW9kZWwucGFyZW50O1xuXG4gICAgICAgIHdoaWxlIChwYXJlbnQpIHtcblxuICAgICAgICAgICAgcGF0aC51bnNoaWZ0KHRoaXMuZ2V0UGF0aFNlZ21lbnQocGFyZW50KSk7XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGpvaW4gPyBwYXRoLmpvaW4oXCIuXCIpIDogcGF0aDtcbiAgICB9XG5cbiAgICBhZGRGb3JtR3JvdXBDb250cm9sKGZvcm1Hcm91cDogRm9ybUdyb3VwLCBmb3JtTW9kZWw6IER5bmFtaWNVbmlvbkZvcm1Nb2RlbCwgLi4ubW9kZWxzOiBEeW5hbWljRm9ybU1vZGVsKTogdm9pZCB7XG5cbiAgICAgICAgaWYgKGZvcm1Nb2RlbCBpbnN0YW5jZW9mIER5bmFtaWNGb3JtR3JvdXBNb2RlbCkge1xuXG4gICAgICAgICAgICB0aGlzLmluc2VydEZvcm1Hcm91cENvbnRyb2woZm9ybU1vZGVsLnNpemUoKSwgZm9ybUdyb3VwLCBmb3JtTW9kZWwsIC4uLm1vZGVscyk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgY29uc3QgbW9kZWwgPSBmb3JtTW9kZWwgYXMgRHluYW1pY0Zvcm1Nb2RlbDtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0Rm9ybUdyb3VwQ29udHJvbChtb2RlbC5sZW5ndGgsIGZvcm1Hcm91cCwgbW9kZWwsIC4uLm1vZGVscyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb3ZlRm9ybUdyb3VwQ29udHJvbChpbmRleDogbnVtYmVyLCBzdGVwOiBudW1iZXIsIGZvcm1Nb2RlbDogRHluYW1pY1VuaW9uRm9ybU1vZGVsKTogdm9pZCB7XG5cbiAgICAgICAgaWYgKGZvcm1Nb2RlbCBpbnN0YW5jZW9mIER5bmFtaWNGb3JtR3JvdXBNb2RlbCkge1xuXG4gICAgICAgICAgICBmb3JtTW9kZWwubW92ZShpbmRleCwgc3RlcCk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgY29uc3QgbW9kZWwgPSBmb3JtTW9kZWwgYXMgRHluYW1pY0Zvcm1Nb2RlbDtcbiAgICAgICAgICAgIG1vZGVsLnNwbGljZShpbmRleCArIHN0ZXAsIDAsIC4uLm1vZGVsLnNwbGljZShpbmRleCwgMSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5zZXJ0Rm9ybUdyb3VwQ29udHJvbChpbmRleDogbnVtYmVyLCBmb3JtR3JvdXA6IEZvcm1Hcm91cCwgZm9ybU1vZGVsOiBEeW5hbWljVW5pb25Gb3JtTW9kZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5tb2RlbHM6IER5bmFtaWNGb3JtTW9kZWwpOiB2b2lkIHtcblxuICAgICAgICBjb25zdCBwYXJlbnQgPSBmb3JtTW9kZWwgaW5zdGFuY2VvZiBEeW5hbWljRm9ybUdyb3VwTW9kZWwgPyBmb3JtTW9kZWwgOiBudWxsO1xuICAgICAgICBjb25zdCBjb250cm9scyA9IHRoaXMuY3JlYXRlRm9ybUdyb3VwKG1vZGVscywgbnVsbCwgcGFyZW50KS5jb250cm9scztcblxuICAgICAgICBPYmplY3Qua2V5cyhjb250cm9scykuZm9yRWFjaCgoY29udHJvbE5hbWUsIGlkeCkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBjb250cm9sTW9kZWwgPSBtb2RlbHNbaWR4XTtcblxuICAgICAgICAgICAgaWYgKGZvcm1Nb2RlbCBpbnN0YW5jZW9mIER5bmFtaWNGb3JtR3JvdXBNb2RlbCkge1xuICAgICAgICAgICAgICAgIGZvcm1Nb2RlbC5pbnNlcnQoaW5kZXgsIGNvbnRyb2xNb2RlbCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgKGZvcm1Nb2RlbCBhcyBEeW5hbWljRm9ybU1vZGVsKS5zcGxpY2UoaW5kZXgsIDAsIGNvbnRyb2xNb2RlbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvcm1Hcm91cC5hZGRDb250cm9sKGNvbnRyb2xOYW1lLCBjb250cm9sc1tjb250cm9sTmFtZV0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZW1vdmVGb3JtR3JvdXBDb250cm9sKGluZGV4OiBudW1iZXIsIGZvcm1Hcm91cDogRm9ybUdyb3VwLCBmb3JtTW9kZWw6IER5bmFtaWNVbmlvbkZvcm1Nb2RlbCk6IHZvaWQge1xuXG4gICAgICAgIGlmIChmb3JtTW9kZWwgaW5zdGFuY2VvZiBEeW5hbWljRm9ybUdyb3VwTW9kZWwpIHtcblxuICAgICAgICAgICAgZm9ybUdyb3VwLnJlbW92ZUNvbnRyb2woZm9ybU1vZGVsLmdldChpbmRleCkuaWQpO1xuICAgICAgICAgICAgZm9ybU1vZGVsLnJlbW92ZShpbmRleCk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgZm9ybUdyb3VwLnJlbW92ZUNvbnRyb2woZm9ybU1vZGVsW2luZGV4XS5pZCk7XG4gICAgICAgICAgICAoZm9ybU1vZGVsIGFzIER5bmFtaWNGb3JtTW9kZWwpLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRGb3JtQXJyYXlHcm91cChmb3JtQXJyYXk6IEZvcm1BcnJheSwgZm9ybUFycmF5TW9kZWw6IER5bmFtaWNGb3JtQXJyYXlNb2RlbCk6IHZvaWQge1xuXG4gICAgICAgIGNvbnN0IGdyb3VwTW9kZWwgPSBmb3JtQXJyYXlNb2RlbC5hZGRHcm91cCgpO1xuXG4gICAgICAgIGZvcm1BcnJheS5wdXNoKHRoaXMuY3JlYXRlRm9ybUdyb3VwKGdyb3VwTW9kZWwuZ3JvdXAsIG51bGwsIGdyb3VwTW9kZWwpKTtcbiAgICB9XG5cbiAgICBpbnNlcnRGb3JtQXJyYXlHcm91cChpbmRleDogbnVtYmVyLCBmb3JtQXJyYXk6IEZvcm1BcnJheSwgZm9ybUFycmF5TW9kZWw6IER5bmFtaWNGb3JtQXJyYXlNb2RlbCk6IHZvaWQge1xuXG4gICAgICAgIGNvbnN0IGdyb3VwTW9kZWwgPSBmb3JtQXJyYXlNb2RlbC5pbnNlcnRHcm91cChpbmRleCk7XG5cbiAgICAgICAgZm9ybUFycmF5Lmluc2VydChpbmRleCwgdGhpcy5jcmVhdGVGb3JtR3JvdXAoZ3JvdXBNb2RlbC5ncm91cCwgbnVsbCwgZ3JvdXBNb2RlbCkpO1xuICAgIH1cblxuICAgIG1vdmVGb3JtQXJyYXlHcm91cChpbmRleDogbnVtYmVyLCBzdGVwOiBudW1iZXIsIGZvcm1BcnJheTogRm9ybUFycmF5LCBmb3JtQXJyYXlNb2RlbDogRHluYW1pY0Zvcm1BcnJheU1vZGVsKTogdm9pZCB7XG5cbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSBpbmRleCArIHN0ZXA7XG4gICAgICAgIGNvbnN0IG1vdmVVcCA9IHN0ZXAgPj0gMDtcblxuICAgICAgICBpZiAoKGluZGV4ID49IDAgJiYgaW5kZXggPCBmb3JtQXJyYXlNb2RlbC5zaXplKSAmJiAobmV3SW5kZXggPj0gMCAmJiBuZXdJbmRleCA8IGZvcm1BcnJheU1vZGVsLnNpemUpKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IG1vdmluZ0dyb3VwczogQWJzdHJhY3RDb250cm9sW10gPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IG1vdmVVcCA/IGluZGV4IDogbmV3SW5kZXg7IGkgPD0gKG1vdmVVcCA/IG5ld0luZGV4IDogaW5kZXgpOyBpKyspIHtcbiAgICAgICAgICAgICAgICBtb3ZpbmdHcm91cHMucHVzaChmb3JtQXJyYXkuYXQoaSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtb3ZpbmdHcm91cHMuZm9yRWFjaCgoZm9ybUNvbnRyb2wsIGlkeCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgbGV0IHBvc2l0aW9uO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1vdmVVcCkge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IGlkeCA9PT0gMCA/IG5ld0luZGV4IDogaW5kZXggKyBpZHggLSAxO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSBpZHggPT09IG1vdmluZ0dyb3Vwcy5sZW5ndGggLSAxID8gbmV3SW5kZXggOiBuZXdJbmRleCArIGlkeCArIDE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9ybUFycmF5LnNldENvbnRyb2wocG9zaXRpb24sIGZvcm1Db250cm9sKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmb3JtQXJyYXlNb2RlbC5tb3ZlR3JvdXAoaW5kZXgsIHN0ZXApO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGZvcm0gYXJyYXkgZ3JvdXAgY2Fubm90IGJlIG1vdmVkIGR1ZSB0byBpbmRleCBvciBuZXcgaW5kZXggYmVpbmcgb3V0IG9mIGJvdW5kc2ApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVtb3ZlRm9ybUFycmF5R3JvdXAoaW5kZXg6IG51bWJlciwgZm9ybUFycmF5OiBGb3JtQXJyYXksIGZvcm1BcnJheU1vZGVsOiBEeW5hbWljRm9ybUFycmF5TW9kZWwpOiB2b2lkIHtcblxuICAgICAgICBmb3JtQXJyYXkucmVtb3ZlQXQoaW5kZXgpO1xuICAgICAgICBmb3JtQXJyYXlNb2RlbC5yZW1vdmVHcm91cChpbmRleCk7XG4gICAgfVxuXG4gICAgY2xlYXJGb3JtQXJyYXkoZm9ybUFycmF5OiBGb3JtQXJyYXksIGZvcm1BcnJheU1vZGVsOiBEeW5hbWljRm9ybUFycmF5TW9kZWwpOiB2b2lkIHtcblxuICAgICAgICBmb3JtQXJyYXkuY2xlYXIoKTtcbiAgICAgICAgZm9ybUFycmF5TW9kZWwuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBmaW5kQnlJZChpZDogc3RyaW5nLCBmb3JtTW9kZWw6IER5bmFtaWNGb3JtTW9kZWwpOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCB8IG51bGwge1xuXG4gICAgICAgIGxldCByZXN1bHQgPSBudWxsO1xuXG4gICAgICAgIGNvbnN0IGZpbmRCeUlkRm4gPSAobW9kZWxJZDogc3RyaW5nLCBncm91cE1vZGVsOiBEeW5hbWljRm9ybU1vZGVsKTogdm9pZCA9PiB7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgY29udHJvbE1vZGVsIG9mIGdyb3VwTW9kZWwpIHtcblxuICAgICAgICAgICAgICAgIGlmIChjb250cm9sTW9kZWwuaWQgPT09IG1vZGVsSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29udHJvbE1vZGVsO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbE1vZGVsIGluc3RhbmNlb2YgRHluYW1pY0Zvcm1Hcm91cE1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRCeUlkRm4obW9kZWxJZCwgKGNvbnRyb2xNb2RlbCBhcyBEeW5hbWljRm9ybUdyb3VwTW9kZWwpLmdyb3VwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgZmluZEJ5SWRGbihpZCwgZm9ybU1vZGVsKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZpbmRNb2RlbEJ5SWQ8VCBleHRlbmRzIER5bmFtaWNGb3JtQ29udHJvbE1vZGVsPihpZDogc3RyaW5nLCBmb3JtTW9kZWw6IER5bmFtaWNGb3JtTW9kZWwpOiBUIHwgbnVsbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmRCeUlkKGlkLCBmb3JtTW9kZWwpIGFzIFQ7XG4gICAgfVxuXG4gICAgZmluZENvbnRyb2xCeU1vZGVsPFQgZXh0ZW5kcyBBYnN0cmFjdENvbnRyb2w+KG1vZGVsOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCwgZ3JvdXA6IEZvcm1Hcm91cCk6IFQgfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIGdyb3VwLnJvb3QuZ2V0KHRoaXMuZ2V0UGF0aChtb2RlbCwgdHJ1ZSkpIGFzIFQ7XG4gICAgfVxuXG4gICAgZGV0ZWN0Q2hhbmdlcyhmb3JtQ29tcG9uZW50PzogRHluYW1pY0Zvcm1Db21wb25lbnQpOiB2b2lkIHtcblxuICAgICAgICBpZiAoZm9ybUNvbXBvbmVudCBpbnN0YW5jZW9mIER5bmFtaWNGb3JtQ29tcG9uZW50KSB7XG5cbiAgICAgICAgICAgIGZvcm1Db21wb25lbnQubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgICBmb3JtQ29tcG9uZW50LmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZvcm0gb2YgdGhpcy5jb21wb25lbnRTZXJ2aWNlLmdldEZvcm1zKCkpIHtcbiAgICAgICAgICAgICAgICBmb3JtLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICAgICAgICAgIGZvcm0uZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnJvbUpTT04oanNvbjogc3RyaW5nIHwgb2JqZWN0W10pOiBEeW5hbWljRm9ybU1vZGVsIHwgbmV2ZXIge1xuXG4gICAgICAgIGNvbnN0IGZvcm1Nb2RlbEpTT04gPSBpc1N0cmluZyhqc29uKSA/IEpTT04ucGFyc2UoanNvbiwgcGFyc2VSZXZpdmVyKSA6IGpzb247XG4gICAgICAgIGNvbnN0IGZvcm1Nb2RlbDogRHluYW1pY0Zvcm1Nb2RlbCA9IFtdO1xuXG4gICAgICAgIGZvcm1Nb2RlbEpTT04uZm9yRWFjaCgobW9kZWw6IGFueSkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBtb2RlbC5sYXlvdXQgPz8gbnVsbDtcblxuICAgICAgICAgICAgc3dpdGNoIChtb2RlbC50eXBlKSB7XG5cbiAgICAgICAgICAgICAgICBjYXNlIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfQVJSQVk6XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1BcnJheU1vZGVsID0gbW9kZWwgYXMgRHluYW1pY0Zvcm1BcnJheU1vZGVsO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGZvcm1BcnJheU1vZGVsLmdyb3VwcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFycmF5TW9kZWwuZ3JvdXBzLmZvckVhY2goKGdyb3VwTW9kZWw6IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBNb2RlbC5ncm91cCA9IHRoaXMuZnJvbUpTT04oZ3JvdXBNb2RlbC5ncm91cCkgYXMgRHluYW1pY0Zvcm1Nb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZm9ybUFycmF5TW9kZWwuZ3JvdXBGYWN0b3J5ID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnJvbUpTT04oZm9ybUFycmF5TW9kZWwuZ3JvdXBQcm90b3R5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGZvcm1Nb2RlbC5wdXNoKG5ldyBEeW5hbWljRm9ybUFycmF5TW9kZWwobW9kZWwsIGxheW91dCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9DSEVDS0JPWDpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNDaGVja2JveE1vZGVsKG1vZGVsLCBsYXlvdXQpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfQ0hFQ0tCT1hfR1JPVVA6XG4gICAgICAgICAgICAgICAgICAgIG1vZGVsLmdyb3VwID0gdGhpcy5mcm9tSlNPTihtb2RlbC5ncm91cCkgYXMgRHluYW1pY0NoZWNrYm94TW9kZWxbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNDaGVja2JveEdyb3VwTW9kZWwobW9kZWwsIGxheW91dCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9DT0xPUlBJQ0tFUjpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNDb2xvclBpY2tlck1vZGVsKG1vZGVsLCBsYXlvdXQpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfREFURVBJQ0tFUjpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNEYXRlUGlja2VyTW9kZWwobW9kZWwsIGxheW91dCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9FRElUT1I6XG4gICAgICAgICAgICAgICAgICAgIGZvcm1Nb2RlbC5wdXNoKG5ldyBEeW5hbWljRWRpdG9yTW9kZWwobW9kZWwsIGxheW91dCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9GSUxFX1VQTE9BRDpcbiAgICAgICAgICAgICAgICAgICAgbW9kZWwudmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBmb3JtTW9kZWwucHVzaChuZXcgRHluYW1pY0ZpbGVVcGxvYWRNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0dST1VQOlxuICAgICAgICAgICAgICAgICAgICBtb2RlbC5ncm91cCA9IHRoaXMuZnJvbUpTT04obW9kZWwuZ3JvdXApO1xuICAgICAgICAgICAgICAgICAgICBmb3JtTW9kZWwucHVzaChuZXcgRHluYW1pY0Zvcm1Hcm91cE1vZGVsKG1vZGVsLCBsYXlvdXQpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfSU5QVVQ6XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0TW9kZWwgPSBtb2RlbCBhcyBEeW5hbWljSW5wdXRNb2RlbDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRNb2RlbC5tYXNrICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpbnB1dE1vZGVsLm1hc2sgaW5zdGFuY2VvZiBGdW5jdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dE1vZGVsLm1hc2sgPSBtYXNrRnJvbVN0cmluZyhpbnB1dE1vZGVsLm1hc2sgYXMgc3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZvcm1Nb2RlbC5wdXNoKG5ldyBEeW5hbWljSW5wdXRNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1JBRElPX0dST1VQOlxuICAgICAgICAgICAgICAgICAgICBmb3JtTW9kZWwucHVzaChuZXcgRHluYW1pY1JhZGlvR3JvdXBNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1JBVElORzpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNSYXRpbmdNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1NFTEVDVDpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNTZWxlY3RNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1NMSURFUjpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNTbGlkZXJNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1NXSVRDSDpcbiAgICAgICAgICAgICAgICAgICAgZm9ybU1vZGVsLnB1c2gobmV3IER5bmFtaWNTd2l0Y2hNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX1RFWFRBUkVBOlxuICAgICAgICAgICAgICAgICAgICBmb3JtTW9kZWwucHVzaChuZXcgRHluYW1pY1RleHRBcmVhTW9kZWwobW9kZWwsIGxheW91dCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9USU1FUElDS0VSOlxuICAgICAgICAgICAgICAgICAgICBmb3JtTW9kZWwucHVzaChuZXcgRHluYW1pY1RpbWVQaWNrZXJNb2RlbChtb2RlbCwgbGF5b3V0KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIGZvcm0gY29udHJvbCBtb2RlbCB0eXBlIGRlZmluZWQgb24gSlNPTiBvYmplY3Qgd2l0aCBpZCBcIiR7bW9kZWwuaWR9XCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZvcm1Nb2RlbDtcbiAgICB9XG59XG4iXX0=