import { Injectable, QueryList } from "@angular/core";
import { DynamicFormArrayGroupModel } from "../model/form-array/dynamic-form-array.model";
import { DYNAMIC_TEMPLATE_DIRECTIVE_ALIGNMENT } from "../directive/dynamic-template.directive";
import { isObject, isString } from "../utils/core.utils";
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
export class DynamicFormLayoutService {
    findById(id, formLayout) {
        if (isObject(formLayout)) {
            for (const key of Object.keys(formLayout)) {
                if (key === id) {
                    return formLayout[key];
                }
            }
        }
        return null;
    }
    findByModel(model, formLayout) {
        let controlLayout = null;
        if (isObject(formLayout)) {
            for (const key of Object.keys(formLayout)) {
                key.split(",").forEach(substring => {
                    const selector = substring.trim();
                    if (selector === model.id || selector === model.type) {
                        controlLayout = formLayout[key];
                    }
                });
            }
        }
        return controlLayout;
    }
    filterTemplatesByModel(model, templates) {
        const filterCallback = (template) => {
            return template.modelId === model.id || template.modelType === model.type;
        };
        if (templates instanceof QueryList) {
            return templates.filter(filterCallback);
        }
        else if (Array.isArray(templates)) {
            return templates.filter(filterCallback);
        }
        return [];
    }
    getAlignedTemplate(model, templates, alignment) {
        return this.filterTemplatesByModel(model, templates)
            .find(template => template.as === null && template.align === alignment);
    }
    /*
    getIndexedTemplates(model: DynamicFormControlModel, templates: DynamicFormControlTemplates): DynamicTemplateDirective[] | undefined {
        return this.filterTemplatesByModel(model, templates).filter(template => template.as === null);
    }
    */
    getStartTemplate(model, templates) {
        return this.getAlignedTemplate(model, templates, DYNAMIC_TEMPLATE_DIRECTIVE_ALIGNMENT.Start);
    }
    getEndTemplate(model, templates) {
        return this.getAlignedTemplate(model, templates, DYNAMIC_TEMPLATE_DIRECTIVE_ALIGNMENT.End);
    }
    getClass(layout, context, place) {
        if (isObject(layout) && layout.hasOwnProperty(context)) {
            const config = layout[context];
            if (config.hasOwnProperty(place)) {
                return config[place];
            }
        }
        return "";
    }
    getHostClass(layout) {
        const keys = ["element", "grid"];
        let cls = "";
        if (isObject(layout)) {
            keys.forEach(key => {
                if (isObject(layout[key]) && isString(layout[key].host)) {
                    cls = cls + ` ${layout[key].host}`;
                }
            });
        }
        return cls;
    }
    getElementId(model) {
        let id = model.id;
        let parent = model.parent;
        while (parent !== null) {
            if (parent instanceof DynamicFormArrayGroupModel) {
                id = `${parent.context.id}-${parent.index}-${model.id}`;
                break;
            }
            parent = parent.parent;
        }
        return id;
    }
}
DynamicFormLayoutService.ɵfac = function DynamicFormLayoutService_Factory(t) { return new (t || DynamicFormLayoutService)(); };
DynamicFormLayoutService.ɵprov = i0.ɵɵdefineInjectable({ factory: function DynamicFormLayoutService_Factory() { return new DynamicFormLayoutService(); }, token: DynamicFormLayoutService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DynamicFormLayoutService, [{
        type: Injectable,
        args: [{
                providedIn: "root"
            }]
    }], null, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLWxheW91dC5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1keW5hbWljLWZvcm1zL2NvcmUvc3JjL2xpYi9zZXJ2aWNlL2R5bmFtaWMtZm9ybS1sYXlvdXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQVF0RCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUMxRixPQUFPLEVBRUgsb0NBQW9DLEVBQ3ZDLE1BQU0seUNBQXlDLENBQUM7QUFDakQsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN6RDs7QUFRQSxNQUFNLE9BQU8sd0JBQXdCO0FBQ3JDLElBQ0ksUUFBUSxDQUFDLEVBQVUsRUFBRSxVQUFvQztBQUFJLFFBRXpELElBQUksUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ2xDLFlBQ1ksS0FBSyxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ3ZELGdCQUNnQixJQUFJLEdBQUcsS0FBSyxFQUFFLEVBQUU7QUFDaEMsb0JBQW9CLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzNDLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNULFFBQ1EsT0FBTyxJQUFJLENBQUM7QUFDcEIsSUFBSSxDQUFDO0FBQ0wsSUFDSSxXQUFXLENBQUMsS0FBOEIsRUFBRSxVQUFvQztBQUFJLFFBRWhGLElBQUksYUFBYSxHQUE2QixJQUFJLENBQUM7QUFDM0QsUUFDUSxJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRTtBQUNsQyxZQUNZLEtBQUssTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRTtBQUN2RCxnQkFDZ0IsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7QUFDbkQsb0JBQ29CLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUN0RCxvQkFDb0IsSUFBSSxRQUFRLEtBQUssS0FBSyxDQUFDLEVBQUUsSUFBSSxRQUFRLEtBQUssS0FBSyxDQUFDLElBQUksRUFBRTtBQUMxRSx3QkFBd0IsYUFBYSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN4RCxxQkFBcUI7QUFDckIsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0FBQ25CLGFBQWE7QUFDYixTQUFTO0FBQ1QsUUFDUSxPQUFPLGFBQWEsQ0FBQztBQUM3QixJQUFJLENBQUM7QUFDTCxJQUNJLHNCQUFzQixDQUFDLEtBQThCLEVBQUUsU0FBc0M7QUFBSSxRQUU3RixNQUFNLGNBQWMsR0FBb0QsQ0FBQyxRQUFrQyxFQUFFLEVBQUU7QUFDdkgsWUFBWSxPQUFPLFFBQVEsQ0FBQyxPQUFPLEtBQUssS0FBSyxDQUFDLEVBQUUsSUFBSSxRQUFRLENBQUMsU0FBUyxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQUM7QUFDdEYsUUFBUSxDQUFDLENBQUM7QUFDVixRQUNRLElBQUksU0FBUyxZQUFZLFNBQVMsRUFBRTtBQUM1QyxZQUFZLE9BQU8sU0FBUyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUNwRCxTQUNTO0FBQUMsYUFBSyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7QUFDN0MsWUFBWSxPQUFPLFNBQVMsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7QUFDcEQsU0FBUztBQUNULFFBQ1EsT0FBTyxFQUFFLENBQUM7QUFDbEIsSUFBSSxDQUFDO0FBQ0wsSUFDSSxrQkFBa0IsQ0FBQyxLQUE4QixFQUFFLFNBQXNDLEVBQ3RFLFNBQStDO0FBQUksUUFFbEUsT0FBTyxJQUFJLENBQUMsc0JBQXNCLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQztBQUM1RCxhQUFhLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssSUFBSSxJQUFJLFFBQVEsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUM7QUFDcEYsSUFBSSxDQUFDO0FBQ0wsSUFDSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixJQUFJLGdCQUFnQixDQUFDLEtBQThCLEVBQUUsU0FBc0M7QUFBSSxRQUN2RixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLG9DQUFvQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3JHLElBQUksQ0FBQztBQUNMLElBQ0ksY0FBYyxDQUFDLEtBQThCLEVBQUUsU0FBc0M7QUFBSSxRQUNyRixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLG9DQUFvQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ25HLElBQUksQ0FBQztBQUNMLElBQ0ksUUFBUSxDQUFDLE1BQW1ELEVBQUUsT0FBd0MsRUFDN0YsS0FBb0M7QUFBSSxRQUU3QyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ2hFLFlBQ1ksTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBbUMsQ0FBQztBQUM3RSxZQUNZLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFBRTtBQUM5QyxnQkFBZ0IsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFXLENBQUM7QUFDL0MsYUFBYTtBQUNiLFNBQVM7QUFDVCxRQUNRLE9BQU8sRUFBRSxDQUFDO0FBQ2xCLElBQUksQ0FBQztBQUNMLElBQ0ksWUFBWSxDQUFDLE1BQW1EO0FBQUksUUFFaEUsTUFBTSxJQUFJLEdBQXVDLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQzdFLFFBQVEsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0FBQ3JCLFFBQ1EsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDOUIsWUFBWSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQy9CLGdCQUFnQixJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFO0FBQ3pFLG9CQUFvQixHQUFHLEdBQUcsR0FBRyxHQUFHLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3ZELGlCQUFpQjtBQUNqQixZQUFZLENBQUMsQ0FBQyxDQUFDO0FBQ2YsU0FBUztBQUNULFFBQ1EsT0FBTyxHQUFHLENBQUM7QUFDbkIsSUFBSSxDQUFDO0FBQ0wsSUFDSSxZQUFZLENBQUMsS0FBOEI7QUFBSSxRQUUzQyxJQUFJLEVBQUUsR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDO0FBQzFCLFFBQVEsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztBQUNsQyxRQUNRLE9BQU8sTUFBTSxLQUFLLElBQUksRUFBRTtBQUNoQyxZQUNZLElBQUksTUFBTSxZQUFZLDBCQUEwQixFQUFFO0FBQzlELGdCQUNnQixFQUFFLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsSUFBSSxNQUFNLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUN4RSxnQkFBZ0IsTUFBTTtBQUN0QixhQUFhO0FBQ2IsWUFDWSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNuQyxTQUFTO0FBQ1QsUUFDUSxPQUFPLEVBQUUsQ0FBQztBQUNsQixJQUFJLENBQUM7QUFDTDsrSEFBQztBQUNEO29EQWhJQyxVQUFVLFNBQUM7TUFDUixVQUFVLEVBQUUsTUFBTTtZQUNyQjs7OzBCQUNJO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBRdWVyeUxpc3QgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtcbiAgICBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQsXG4gICAgRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0Q29uZmlnLFxuICAgIER5bmFtaWNGb3JtQ29udHJvbExheW91dENvbnRleHQsXG4gICAgRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0UGxhY2Vcbn0gZnJvbSBcIi4uL21vZGVsL21pc2MvZHluYW1pYy1mb3JtLWNvbnRyb2wtbGF5b3V0Lm1vZGVsXCI7XG5pbXBvcnQgeyBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9keW5hbWljLWZvcm0tY29udHJvbC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWwgfSBmcm9tIFwiLi4vbW9kZWwvZm9ybS1hcnJheS9keW5hbWljLWZvcm0tYXJyYXkubW9kZWxcIjtcbmltcG9ydCB7XG4gICAgRHluYW1pY1RlbXBsYXRlRGlyZWN0aXZlLFxuICAgIERZTkFNSUNfVEVNUExBVEVfRElSRUNUSVZFX0FMSUdOTUVOVFxufSBmcm9tIFwiLi4vZGlyZWN0aXZlL2R5bmFtaWMtdGVtcGxhdGUuZGlyZWN0aXZlXCI7XG5pbXBvcnQgeyBpc09iamVjdCwgaXNTdHJpbmcgfSBmcm9tIFwiLi4vdXRpbHMvY29yZS51dGlsc1wiO1xuXG5leHBvcnQgdHlwZSBEeW5hbWljRm9ybUxheW91dCA9IHsgW2lkOiBzdHJpbmddOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQgfTtcblxuZXhwb3J0IHR5cGUgRHluYW1pY0Zvcm1Db250cm9sVGVtcGxhdGVzID0gUXVlcnlMaXN0PER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZT4gfCBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmVbXSB8IHVuZGVmaW5lZDtcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46IFwicm9vdFwiXG59KVxuZXhwb3J0IGNsYXNzIER5bmFtaWNGb3JtTGF5b3V0U2VydmljZSB7XG5cbiAgICBmaW5kQnlJZChpZDogc3RyaW5nLCBmb3JtTGF5b3V0OiBEeW5hbWljRm9ybUxheW91dCB8IG51bGwpOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQgfCBudWxsIHtcblxuICAgICAgICBpZiAoaXNPYmplY3QoZm9ybUxheW91dCkpIHtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoZm9ybUxheW91dCkpIHtcblxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JtTGF5b3V0W2tleV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgZmluZEJ5TW9kZWwobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCBmb3JtTGF5b3V0OiBEeW5hbWljRm9ybUxheW91dCB8IG51bGwpOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQgfCBudWxsIHtcblxuICAgICAgICBsZXQgY29udHJvbExheW91dDogRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0ID0gbnVsbDtcblxuICAgICAgICBpZiAoaXNPYmplY3QoZm9ybUxheW91dCkpIHtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoZm9ybUxheW91dCkpIHtcblxuICAgICAgICAgICAgICAgIGtleS5zcGxpdChcIixcIikuZm9yRWFjaChzdWJzdHJpbmcgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdG9yID0gc3Vic3RyaW5nLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IgPT09IG1vZGVsLmlkIHx8IHNlbGVjdG9yID09PSBtb2RlbC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sTGF5b3V0ID0gZm9ybUxheW91dFtrZXldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29udHJvbExheW91dDtcbiAgICB9XG5cbiAgICBmaWx0ZXJUZW1wbGF0ZXNCeU1vZGVsKG1vZGVsOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCwgdGVtcGxhdGVzOiBEeW5hbWljRm9ybUNvbnRyb2xUZW1wbGF0ZXMpOiBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmVbXSB7XG5cbiAgICAgICAgY29uc3QgZmlsdGVyQ2FsbGJhY2s6ICh0ZW1wbGF0ZTogRHluYW1pY1RlbXBsYXRlRGlyZWN0aXZlKSA9PiBib29sZWFuID0gKHRlbXBsYXRlOiBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0ZW1wbGF0ZS5tb2RlbElkID09PSBtb2RlbC5pZCB8fCB0ZW1wbGF0ZS5tb2RlbFR5cGUgPT09IG1vZGVsLnR5cGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRlbXBsYXRlcyBpbnN0YW5jZW9mIFF1ZXJ5TGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlcy5maWx0ZXIoZmlsdGVyQ2FsbGJhY2spO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh0ZW1wbGF0ZXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzLmZpbHRlcihmaWx0ZXJDYWxsYmFjayk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgZ2V0QWxpZ25lZFRlbXBsYXRlKG1vZGVsOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCwgdGVtcGxhdGVzOiBEeW5hbWljRm9ybUNvbnRyb2xUZW1wbGF0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudDogRFlOQU1JQ19URU1QTEFURV9ESVJFQ1RJVkVfQUxJR05NRU5UKTogRHluYW1pY1RlbXBsYXRlRGlyZWN0aXZlIHwgdW5kZWZpbmVkIHtcblxuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJUZW1wbGF0ZXNCeU1vZGVsKG1vZGVsLCB0ZW1wbGF0ZXMpXG4gICAgICAgICAgICAuZmluZCh0ZW1wbGF0ZSA9PiB0ZW1wbGF0ZS5hcyA9PT0gbnVsbCAmJiB0ZW1wbGF0ZS5hbGlnbiA9PT0gYWxpZ25tZW50KTtcbiAgICB9XG5cbiAgICAvKlxuICAgIGdldEluZGV4ZWRUZW1wbGF0ZXMobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCB0ZW1wbGF0ZXM6IER5bmFtaWNGb3JtQ29udHJvbFRlbXBsYXRlcyk6IER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZVtdIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyVGVtcGxhdGVzQnlNb2RlbChtb2RlbCwgdGVtcGxhdGVzKS5maWx0ZXIodGVtcGxhdGUgPT4gdGVtcGxhdGUuYXMgPT09IG51bGwpO1xuICAgIH1cbiAgICAqL1xuICAgIGdldFN0YXJ0VGVtcGxhdGUobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCB0ZW1wbGF0ZXM6IER5bmFtaWNGb3JtQ29udHJvbFRlbXBsYXRlcyk6IER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsaWduZWRUZW1wbGF0ZShtb2RlbCwgdGVtcGxhdGVzLCBEWU5BTUlDX1RFTVBMQVRFX0RJUkVDVElWRV9BTElHTk1FTlQuU3RhcnQpO1xuICAgIH1cblxuICAgIGdldEVuZFRlbXBsYXRlKG1vZGVsOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCwgdGVtcGxhdGVzOiBEeW5hbWljRm9ybUNvbnRyb2xUZW1wbGF0ZXMpOiBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmUgfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGlnbmVkVGVtcGxhdGUobW9kZWwsIHRlbXBsYXRlcywgRFlOQU1JQ19URU1QTEFURV9ESVJFQ1RJVkVfQUxJR05NRU5ULkVuZCk7XG4gICAgfVxuXG4gICAgZ2V0Q2xhc3MobGF5b3V0OiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQgfCBudWxsIHwgdW5kZWZpbmVkLCBjb250ZXh0OiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXRDb250ZXh0LFxuICAgICAgICAgICAgIHBsYWNlOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXRQbGFjZSk6IHN0cmluZyB7XG5cbiAgICAgICAgaWYgKGlzT2JqZWN0KGxheW91dCkgJiYgbGF5b3V0Lmhhc093blByb3BlcnR5KGNvbnRleHQpKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IGxheW91dFtjb250ZXh0XSBhcyBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXRDb25maWc7XG5cbiAgICAgICAgICAgIGlmIChjb25maWcuaGFzT3duUHJvcGVydHkocGxhY2UpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1twbGFjZV0gYXMgc3RyaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgZ2V0SG9zdENsYXNzKGxheW91dDogRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0IHwgbnVsbCB8IHVuZGVmaW5lZCk6IHN0cmluZyB7XG5cbiAgICAgICAgY29uc3Qga2V5czogKGtleW9mIER5bmFtaWNGb3JtQ29udHJvbExheW91dClbXSA9IFtcImVsZW1lbnRcIiwgXCJncmlkXCJdO1xuICAgICAgICBsZXQgY2xzID0gXCJcIjtcblxuICAgICAgICBpZiAoaXNPYmplY3QobGF5b3V0KSkge1xuICAgICAgICAgICAga2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlzT2JqZWN0KGxheW91dFtrZXldKSAmJiBpc1N0cmluZyhsYXlvdXRba2V5XS5ob3N0KSkge1xuICAgICAgICAgICAgICAgICAgICBjbHMgPSBjbHMgKyBgICR7bGF5b3V0W2tleV0uaG9zdH1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNscztcbiAgICB9XG5cbiAgICBnZXRFbGVtZW50SWQobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsKTogc3RyaW5nIHtcblxuICAgICAgICBsZXQgaWQgPSBtb2RlbC5pZDtcbiAgICAgICAgbGV0IHBhcmVudCA9IG1vZGVsLnBhcmVudDtcblxuICAgICAgICB3aGlsZSAocGFyZW50ICE9PSBudWxsKSB7XG5cbiAgICAgICAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCkge1xuXG4gICAgICAgICAgICAgICAgaWQgPSBgJHtwYXJlbnQuY29udGV4dC5pZH0tJHtwYXJlbnQuaW5kZXh9LSR7bW9kZWwuaWR9YDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9XG59XG4iXX0=