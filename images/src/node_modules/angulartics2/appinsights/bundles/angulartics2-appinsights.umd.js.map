{"version":3,"file":"angulartics2-appinsights.umd.js","sources":["../../../../src/lib/providers/appinsights/appinsights.ts","../../../../src/lib/providers/appinsights/angulartics2-appinsights.ts"],"names":["filter","NavigationStart","NavigationError","NavigationEnd","Injectable","Angulartics2","Title","Router"],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport {\n  NavigationEnd,\n  NavigationError,\n  NavigationStart,\n  Router,\n} from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { Angulartics2, AppInsightsSettings } from 'angulartics2';\n\ndeclare const appInsights: Microsoft.ApplicationInsights.IAppInsights;\n\nexport class AppInsightsDefaults implements AppInsightsSettings {\n  userId = null;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class Angulartics2AppInsights {\n  loadStartTime: number = null;\n  loadTime: number = null;\n\n  metrics: { [name: string]: number } = null;\n  dimensions: { [name: string]: string } = null;\n  measurements: { [name: string]: number } = null;\n\n  constructor(\n    private angulartics2: Angulartics2,\n    private title: Title,\n    private router: Router,\n  ) {\n    if (typeof appInsights === 'undefined') {\n      console.warn('appInsights not found');\n    }\n\n    const defaults = new AppInsightsDefaults();\n    // Set the default settings for this module\n    this.angulartics2.settings.appInsights = { ...defaults, ...this.angulartics2.settings.appInsights };\n    this.angulartics2.setUsername\n      .subscribe((x: string) => this.setUsername(x));\n    this.angulartics2.setUserProperties\n      .subscribe((x) => this.setUserProperties(x));\n  }\n\n  startTracking(): void {\n    this.angulartics2.pageTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe((x) => this.pageTrack(x.path));\n    this.angulartics2.eventTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe((x) => this.eventTrack(x.action, x.properties));\n    this.angulartics2.exceptionTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe((x) => this.exceptionTrack(x));\n    this.router.events\n      .pipe(\n        this.angulartics2.filterDeveloperMode(),\n        filter(event => event instanceof NavigationStart),\n    )\n      .subscribe(event => this.startTimer());\n\n    this.router.events\n      .pipe(filter(event => event instanceof NavigationError || event instanceof NavigationEnd))\n      .subscribe(error => this.stopTimer());\n  }\n\n  startTimer() {\n    this.loadStartTime = Date.now();\n    this.loadTime = null;\n  }\n\n  stopTimer() {\n    this.loadTime = Date.now() - this.loadStartTime;\n    this.loadStartTime = null;\n  }\n\n  /**\n   * Page Track in Baidu Analytics\n   *\n   * @param path - Location 'path'\n   *\n   * @link https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#trackpageview\n   */\n  pageTrack(path: string) {\n    appInsights.trackPageView(\n      this.title.getTitle(),\n      path,\n      this.dimensions,\n      this.metrics,\n      this.loadTime,\n    );\n  }\n\n  /**\n   * Log a user action or other occurrence.\n   *\n   * @param name Name to identify this event in the portal.\n   * @param properties Additional data used to filter events and metrics in the portal. Defaults to empty.\n   *\n   * @link https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#trackevent\n   */\n  eventTrack(name: string, properties: { [name: string]: string }) {\n    appInsights.trackEvent(name, properties, this.measurements);\n  }\n\n  /**\n   * Exception Track Event in GA\n   *\n   * @param properties - Comprised of the mandatory fields 'appId' (string), 'appName' (string) and 'appVersion' (string) and\n   * optional fields 'fatal' (boolean) and 'description' (string), error\n   *\n   * @link https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#trackexception\n   */\n  exceptionTrack(properties: any) {\n    const description = properties.event || properties.description || properties;\n\n    appInsights.trackException(description);\n  }\n\n  /**\n   * @link https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#setauthenticatedusercontext\n   */\n  setUsername(userId: string) {\n    this.angulartics2.settings.appInsights.userId = userId;\n    appInsights.setAuthenticatedUserContext(userId);\n  }\n\n  setUserProperties(properties: Partial<{ userId: string, accountId: string }>) {\n    if (properties.userId) {\n      this.angulartics2.settings.appInsights.userId = properties.userId;\n    }\n    if (properties.accountId) {\n      appInsights.setAuthenticatedUserContext(\n        this.angulartics2.settings.appInsights.userId,\n        properties.accountId,\n      );\n    } else {\n      appInsights.setAuthenticatedUserContext(\n        this.angulartics2.settings.appInsights.userId,\n      );\n    }\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './appinsights';\n"]}