{"version":3,"sources":["webpack:///src/app/core/data/dso-redirect-data.service.ts","webpack:///src/app/+lookup-by-id/lookup-guard.ts","webpack:///src/app/+lookup-by-id/objectnotfound/themed-objectnotfound.component.ts","webpack:///src/app/shared/theme-support/themed.component.html","webpack:///src/app/+lookup-by-id/lookup-by-id-routing.module.ts","webpack:///src/app/+lookup-by-id/lookup-by-id.module.ts","webpack:///src/themes lazy ^\\.\\/.*\\/app\\/\\+lookup\\-by\\-id\\/objectnotfound\\/objectnotfound\\.component$ namespace object"],"names":["DsoRedirectDataService","requestService","rdbService","store","objectCache","halService","notificationsService","http","comparator","router","super","linkPath","uuidEndpoint","identifierType","UUID","this","endpoint","resourceID","linksToFollow","buildHrefFromFindOptions","replace","id","setLinkPath","findById","pipe","g","tap","response","hasSucceeded","dso","payload","uuid","newRoute","getEndpointFromDSOType","type","startsWith","navigate","dsoType","LookupGuard","dsoService","route","state","params","getLookupParams","findByIdAndIDType","map","hasFailed","idType","HANDLE","ThemedObjectNotFoundComponent","themeName","LookupRoutingModule","forChild","matcher","urlMatcher","canActivate","component","url","path","slice","us","join","consumed","posParams","LookupIdModule","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","all","keys","Object","module","exports"],"mappings":"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","file":"x","sourcesContent":["import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Store } from '@ngrx/store';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { hasValue } from '../../shared/empty.util';\nimport { NotificationsService } from '../../shared/notifications/notifications.service';\nimport { FollowLinkConfig } from '../../shared/utils/follow-link-config.model';\nimport { RemoteDataBuildService } from '../cache/builders/remote-data-build.service';\nimport { ObjectCacheService } from '../cache/object-cache.service';\nimport { CoreState } from '../core.reducers';\nimport { HALEndpointService } from '../shared/hal-endpoint.service';\nimport { DataService } from './data.service';\nimport { DSOChangeAnalyzer } from './dso-change-analyzer.service';\nimport { RemoteData } from './remote-data';\nimport { IdentifierType } from './request.models';\nimport { RequestService } from './request.service';\nimport { getFirstCompletedRemoteData } from '../shared/operators';\nimport { DSpaceObject } from '../shared/dspace-object.model';\nimport { Item } from '../shared/item.model';\nimport { getItemPageRoute } from '../../+item-page/item-page-routing-paths';\n\n@Injectable()\nexport class DsoRedirectDataService extends DataService<any> {\n\n  // Set the default link path to the identifier lookup endpoint.\n  protected linkPath = 'pid';\n  private uuidEndpoint = 'dso';\n\n  constructor(\n    protected requestService: RequestService,\n    protected rdbService: RemoteDataBuildService,\n    protected store: Store<CoreState>,\n    protected objectCache: ObjectCacheService,\n    protected halService: HALEndpointService,\n    protected notificationsService: NotificationsService,\n    protected http: HttpClient,\n    protected comparator: DSOChangeAnalyzer<any>,\n    private router: Router) {\n    super();\n  }\n\n  setLinkPath(identifierType: IdentifierType) {\n    // The default 'pid' endpoint for identifiers does not support uuid lookups.\n    // For uuid lookups we need to change the linkPath.\n    if (identifierType === IdentifierType.UUID) {\n      this.linkPath = this.uuidEndpoint;\n    }\n  }\n\n  getIDHref(endpoint, resourceID, ...linksToFollow: FollowLinkConfig<any>[]): string {\n    // Supporting both identifier (pid) and uuid (dso) endpoints\n    return this.buildHrefFromFindOptions( endpoint.replace(/\\{\\?id\\}/, `?id=${resourceID}`)\n        .replace(/\\{\\?uuid\\}/, `?uuid=${resourceID}`),\n      {}, [], ...linksToFollow);\n  }\n\n  findByIdAndIDType(id: string, identifierType = IdentifierType.UUID): Observable<RemoteData<DSpaceObject>> {\n    this.setLinkPath(identifierType);\n    return this.findById(id).pipe(\n      getFirstCompletedRemoteData(),\n      tap((response) => {\n        if (response.hasSucceeded) {\n          const dso = response.payload;\n          const uuid = dso.uuid;\n          if (hasValue(uuid)) {\n            let newRoute = this.getEndpointFromDSOType(response.payload.type);\n            if (dso.type.startsWith('item')) {\n              newRoute = getItemPageRoute(dso as Item);\n            } else if (hasValue(newRoute)) {\n              newRoute += '/' + uuid;\n            }\n            if (hasValue(newRoute)) {\n              this.router.navigate([newRoute]);\n            }\n          }\n        }\n      })\n    );\n  }\n  // Is there an existing method somewhere else that converts dso type to route?\n  getEndpointFromDSOType(dsoType: string): string {\n    // Are there other types to consider?\n    if (dsoType.startsWith('item')) {\n      return 'items';\n    } else if (dsoType.startsWith('community')) {\n      return 'communities';\n    } else if (dsoType.startsWith('collection')) {\n      return 'collections';\n    } else {\n      return '';\n    }\n  }\n}\n","import { ActivatedRouteSnapshot, CanActivate, RouterStateSnapshot } from '@angular/router';\nimport { Injectable } from '@angular/core';\nimport { IdentifierType } from '../core/data/request.models';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { RemoteData } from '../core/data/remote-data';\nimport { DsoRedirectDataService } from '../core/data/dso-redirect-data.service';\nimport { DSpaceObject } from '../core/shared/dspace-object.model';\n\ninterface LookupParams {\n  type: IdentifierType;\n  id: string;\n}\n\n@Injectable()\nexport class LookupGuard implements CanActivate {\n\n  constructor(private dsoService: DsoRedirectDataService) {\n  }\n\n  canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<boolean>  {\n    const params = this.getLookupParams(route);\n    return this.dsoService.findByIdAndIDType(params.id, params.type).pipe(\n      map((response: RemoteData<DSpaceObject>) => response.hasFailed)\n    );\n  }\n\n  private getLookupParams(route: ActivatedRouteSnapshot): LookupParams {\n    let type;\n    let id;\n    const idType = route.params.idType;\n\n    // If the idType is not recognized, assume a legacy handle request (handle/prefix/id)\n    if (idType !== IdentifierType.HANDLE && idType !== IdentifierType.UUID) {\n      type = IdentifierType.HANDLE;\n      const prefix = route.params.idType;\n      const handleId = route.params.id;\n      id = `hdl:${prefix}/${handleId}`;\n\n    } else if (route.params.idType === IdentifierType.HANDLE) {\n      type = IdentifierType.HANDLE;\n      id = 'hdl:' + route.params.id;\n\n    } else {\n      type = IdentifierType.UUID;\n      id = route.params.id;\n    }\n    return {\n      type: type,\n      id: id\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { ThemedComponent } from '../../shared/theme-support/themed.component';\nimport { ObjectNotFoundComponent } from './objectnotfound.component';\n\n/**\n * Themed wrapper for ObjectNotFoundComponent\n */\n@Component({\n  selector: 'ds-themed-objnotfound',\n  styleUrls: [],\n  templateUrl: '../../shared/theme-support/themed.component.html',\n})\nexport class ThemedObjectNotFoundComponent extends ThemedComponent<ObjectNotFoundComponent> {\n  protected getComponentName(): string {\n    return 'ObjectNotFoundComponent';\n  }\n\n  protected importThemedComponent(themeName: string): Promise<any> {\n    return import(`../../../themes/${themeName}/app/+lookup-by-id/objectnotfound/objectnotfound.component`);\n  }\n\n  protected importUnthemedComponent(): Promise<any> {\n    return import(`./objectnotfound.component`);\n  }\n\n}\n","<ng-template #vcr></ng-template>\n","import { LookupGuard } from './lookup-guard';\nimport { NgModule } from '@angular/core';\nimport { RouterModule, UrlSegment } from '@angular/router';\nimport { isNotEmpty } from '../shared/empty.util';\nimport { ThemedObjectNotFoundComponent } from './objectnotfound/themed-objectnotfound.component';\n\n@NgModule({\n  imports: [\n    RouterModule.forChild([\n      {\n        matcher: urlMatcher,\n        canActivate: [LookupGuard],\n        component: ThemedObjectNotFoundComponent  }\n    ])\n  ],\n  providers: [\n    LookupGuard\n  ]\n})\n\nexport class LookupRoutingModule {\n\n}\n\nexport function urlMatcher(url) {\n  // The expected path is :idType/:id\n  const idType = url[0].path;\n  // Allow for handles that are delimited with a forward slash.\n  const id = url\n    .slice(1)\n    .map((us: UrlSegment) => us.path)\n    .join('/');\n  if (isNotEmpty(idType) && isNotEmpty(id)) {\n    return {\n      consumed: url,\n      posParams: {\n        idType: new UrlSegment(idType, {}),\n        id: new UrlSegment(id, {})\n      }\n    };\n  }\n  return null;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SharedModule } from '../shared/shared.module';\nimport { LookupRoutingModule } from './lookup-by-id-routing.module';\nimport { ObjectNotFoundComponent } from './objectnotfound/objectnotfound.component';\nimport { DsoRedirectDataService } from '../core/data/dso-redirect-data.service';\nimport { ThemedObjectNotFoundComponent } from './objectnotfound/themed-objectnotfound.component';\n\n@NgModule({\n  imports: [\n    LookupRoutingModule,\n    CommonModule,\n    SharedModule,\n  ],\n  declarations: [\n    ObjectNotFoundComponent,\n    ThemedObjectNotFoundComponent\n  ],\n  providers: [\n    DsoRedirectDataService\n  ]\n})\nexport class LookupIdModule {\n\n}\n","var map = {\n\t\"./custom/app/+lookup-by-id/objectnotfound/objectnotfound.component\": [\n\t\t\"mYgp\",\n\t\t0,\n\t\t51\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = \"edtC\";\nmodule.exports = webpackAsyncContext;"]}